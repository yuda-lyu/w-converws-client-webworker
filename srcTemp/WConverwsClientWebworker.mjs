import genID from 'wsemi/src/genID.mjs'
import genPm from 'wsemi/src/genPm.mjs'
import Evem from 'wsemi/src/evem.mjs'
import isfun from 'wsemi/src/isfun.mjs'
//import b642u8arr from 'wsemi/src/b642u8arr.mjs'
import b642str from 'wsemi/src/b642str.mjs'


//codeB64, 此處需提供worker執行程式碼, 因有特殊符號編譯困難, 故需先轉base64再使用
let codeB64 = 'IWZ1bmN0aW9uKGUsbil7Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzJiYidW5kZWZpbmVkIiE9dHlwZW9mIG1vZHVsZT9uKCk6ImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUobik6bigpfSgwLGZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXt2YXIgbj10aGlzLmNvbnN0cnVjdG9yO3JldHVybiB0aGlzLnRoZW4oZnVuY3Rpb24odCl7cmV0dXJuIG4ucmVzb2x2ZShlKCkpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gdH0pfSxmdW5jdGlvbih0KXtyZXR1cm4gbi5yZXNvbHZlKGUoKSkudGhlbihmdW5jdGlvbigpe3JldHVybiBuLnJlamVjdCh0KX0pfSl9ZnVuY3Rpb24gbihlKXtyZXR1cm4hKCFlfHwidW5kZWZpbmVkIj09dHlwZW9mIGUubGVuZ3RoKX1mdW5jdGlvbiB0KCl7fWZ1bmN0aW9uIG8oZSl7aWYoISh0aGlzIGluc3RhbmNlb2YgbykpdGhyb3cgbmV3IFR5cGVFcnJvcigiUHJvbWlzZXMgbXVzdCBiZSBjb25zdHJ1Y3RlZCB2aWEgbmV3Iik7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUpdGhyb3cgbmV3IFR5cGVFcnJvcigibm90IGEgZnVuY3Rpb24iKTt0aGlzLl9zdGF0ZT0wLHRoaXMuX2hhbmRsZWQ9ITEsdGhpcy5fdmFsdWU9dW5kZWZpbmVkLHRoaXMuX2RlZmVycmVkcz1bXSxjKGUsdGhpcyl9ZnVuY3Rpb24gcihlLG4pe2Zvcig7Mz09PWUuX3N0YXRlOyllPWUuX3ZhbHVlOzAhPT1lLl9zdGF0ZT8oZS5faGFuZGxlZD0hMCxvLl9pbW1lZGlhdGVGbihmdW5jdGlvbigpe3ZhciB0PTE9PT1lLl9zdGF0ZT9uLm9uRnVsZmlsbGVkOm4ub25SZWplY3RlZDtpZihudWxsIT09dCl7dmFyIG87dHJ5e289dChlLl92YWx1ZSl9Y2F0Y2gocil7cmV0dXJuIHZvaWQgZihuLnByb21pc2Uscil9aShuLnByb21pc2Usbyl9ZWxzZSgxPT09ZS5fc3RhdGU/aTpmKShuLnByb21pc2UsZS5fdmFsdWUpfSkpOmUuX2RlZmVycmVkcy5wdXNoKG4pfWZ1bmN0aW9uIGkoZSxuKXt0cnl7aWYobj09PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiQSBwcm9taXNlIGNhbm5vdCBiZSByZXNvbHZlZCB3aXRoIGl0c2VsZi4iKTtpZihuJiYoIm9iamVjdCI9PXR5cGVvZiBufHwiZnVuY3Rpb24iPT10eXBlb2Ygbikpe3ZhciB0PW4udGhlbjtpZihuIGluc3RhbmNlb2YgbylyZXR1cm4gZS5fc3RhdGU9MyxlLl92YWx1ZT1uLHZvaWQgdShlKTtpZigiZnVuY3Rpb24iPT10eXBlb2YgdClyZXR1cm4gdm9pZCBjKGZ1bmN0aW9uKGUsbil7cmV0dXJuIGZ1bmN0aW9uKCl7ZS5hcHBseShuLGFyZ3VtZW50cyl9fSh0LG4pLGUpfWUuX3N0YXRlPTEsZS5fdmFsdWU9bix1KGUpfWNhdGNoKHIpe2YoZSxyKX19ZnVuY3Rpb24gZihlLG4pe2UuX3N0YXRlPTIsZS5fdmFsdWU9bix1KGUpfWZ1bmN0aW9uIHUoZSl7Mj09PWUuX3N0YXRlJiYwPT09ZS5fZGVmZXJyZWRzLmxlbmd0aCYmby5faW1tZWRpYXRlRm4oZnVuY3Rpb24oKXtlLl9oYW5kbGVkfHxvLl91bmhhbmRsZWRSZWplY3Rpb25GbihlLl92YWx1ZSl9KTtmb3IodmFyIG49MCx0PWUuX2RlZmVycmVkcy5sZW5ndGg7dD5uO24rKylyKGUsZS5fZGVmZXJyZWRzW25dKTtlLl9kZWZlcnJlZHM9bnVsbH1mdW5jdGlvbiBjKGUsbil7dmFyIHQ9ITE7dHJ5e2UoZnVuY3Rpb24oZSl7dHx8KHQ9ITAsaShuLGUpKX0sZnVuY3Rpb24oZSl7dHx8KHQ9ITAsZihuLGUpKX0pfWNhdGNoKG8pe2lmKHQpcmV0dXJuO3Q9ITAsZihuLG8pfX12YXIgYT1zZXRUaW1lb3V0O28ucHJvdG90eXBlWyJjYXRjaCJdPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnRoZW4obnVsbCxlKX0sby5wcm90b3R5cGUudGhlbj1mdW5jdGlvbihlLG4pe3ZhciBvPW5ldyB0aGlzLmNvbnN0cnVjdG9yKHQpO3JldHVybiByKHRoaXMsbmV3IGZ1bmN0aW9uKGUsbix0KXt0aGlzLm9uRnVsZmlsbGVkPSJmdW5jdGlvbiI9PXR5cGVvZiBlP2U6bnVsbCx0aGlzLm9uUmVqZWN0ZWQ9ImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpudWxsLHRoaXMucHJvbWlzZT10fShlLG4sbykpLG99LG8ucHJvdG90eXBlWyJmaW5hbGx5Il09ZSxvLmFsbD1mdW5jdGlvbihlKXtyZXR1cm4gbmV3IG8oZnVuY3Rpb24odCxvKXtmdW5jdGlvbiByKGUsbil7dHJ5e2lmKG4mJigib2JqZWN0Ij09dHlwZW9mIG58fCJmdW5jdGlvbiI9PXR5cGVvZiBuKSl7dmFyIHU9bi50aGVuO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiB1KXJldHVybiB2b2lkIHUuY2FsbChuLGZ1bmN0aW9uKG4pe3IoZSxuKX0sbyl9aVtlXT1uLDA9PS0tZiYmdChpKX1jYXRjaChjKXtvKGMpfX1pZighbihlKSlyZXR1cm4gbyhuZXcgVHlwZUVycm9yKCJQcm9taXNlLmFsbCBhY2NlcHRzIGFuIGFycmF5IikpO3ZhciBpPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGUpO2lmKDA9PT1pLmxlbmd0aClyZXR1cm4gdChbXSk7Zm9yKHZhciBmPWkubGVuZ3RoLHU9MDtpLmxlbmd0aD51O3UrKylyKHUsaVt1XSl9KX0sby5yZXNvbHZlPWZ1bmN0aW9uKGUpe3JldHVybiBlJiYib2JqZWN0Ij09dHlwZW9mIGUmJmUuY29uc3RydWN0b3I9PT1vP2U6bmV3IG8oZnVuY3Rpb24obil7bihlKX0pfSxvLnJlamVjdD1mdW5jdGlvbihlKXtyZXR1cm4gbmV3IG8oZnVuY3Rpb24obix0KXt0KGUpfSl9LG8ucmFjZT1mdW5jdGlvbihlKXtyZXR1cm4gbmV3IG8oZnVuY3Rpb24odCxyKXtpZighbihlKSlyZXR1cm4gcihuZXcgVHlwZUVycm9yKCJQcm9taXNlLnJhY2UgYWNjZXB0cyBhbiBhcnJheSIpKTtmb3IodmFyIGk9MCxmPWUubGVuZ3RoO2Y+aTtpKyspby5yZXNvbHZlKGVbaV0pLnRoZW4odCxyKX0pfSxvLl9pbW1lZGlhdGVGbj0iZnVuY3Rpb24iPT10eXBlb2Ygc2V0SW1tZWRpYXRlJiZmdW5jdGlvbihlKXtzZXRJbW1lZGlhdGUoZSl9fHxmdW5jdGlvbihlKXthKGUsMCl9LG8uX3VuaGFuZGxlZFJlamVjdGlvbkZuPWZ1bmN0aW9uKGUpe3ZvaWQgMCE9PWNvbnNvbGUmJmNvbnNvbGUmJmNvbnNvbGUud2FybigiUG9zc2libGUgVW5oYW5kbGVkIFByb21pc2UgUmVqZWN0aW9uOiIsZSl9O3ZhciBsPWZ1bmN0aW9uKCl7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmKXJldHVybiBzZWxmO2lmKCJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93KXJldHVybiB3aW5kb3c7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWwpcmV0dXJuIGdsb2JhbDt0aHJvdyBFcnJvcigidW5hYmxlIHRvIGxvY2F0ZSBnbG9iYWwgb2JqZWN0Iil9KCk7IlByb21pc2UiaW4gbD9sLlByb21pc2UucHJvdG90eXBlWyJmaW5hbGx5Il18fChsLlByb21pc2UucHJvdG90eXBlWyJmaW5hbGx5Il09ZSk6bC5Qcm9taXNlPW99KTt2YXIgV0NvbnZlcndzQ2xpZW50PWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIG4oKXtyZXR1cm4idW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmdm9pZCAwIT09d2luZG93LmRvY3VtZW50fWZ1bmN0aW9uIHIodCl7dmFyIG49T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpO3JldHVybiJbb2JqZWN0IEZ1bmN0aW9uXSI9PT1ufHwiW29iamVjdCBBc3luY0Z1bmN0aW9uXSI9PT1ufWZ1bmN0aW9uIGUoZSl7dmFyIG89bnVsbDtlLnVybHx8KGUudXJsPSJ3czovL2xvY2FsaG9zdDo4MDgwIiksZS50b2tlbnx8KGUudG9rZW49IioiKTt2YXIgaSx1PWZ1bmN0aW9uKCl7dmFyIHQ9bigpLHI9InVuZGVmaW5lZCIhPXR5cGVvZiBXb3JrZXJHbG9iYWxTY29wZSYmc2VsZiBpbnN0YW5jZW9mIFdvcmtlckdsb2JhbFNjb3BlO3JldHVybntpc0Jyb3dzZXI6dD10fHxyLGlzV2ViV29ya2VyOnIsaXNOb2RlOiJ1bmRlZmluZWQiIT10eXBlb2YgcHJvY2VzcyYmbnVsbCE9cHJvY2Vzcy52ZXJzaW9ucyYmbnVsbCE9cHJvY2Vzcy52ZXJzaW9ucy5ub2RlfX0oKS5pc0Jyb3dzZXI7aT11PygidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjpuKCk/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDpudWxsKS5XZWJTb2NrZXQ6dDt0cnl7bz1uZXcgaShlLnVybCsiLz90b2tlbj0iK2UudG9rZW4pfWNhdGNoKHQpe289bnVsbH1pZihudWxsPT09bylyZXR1cm57ZXJyb3I6ImNhbiBub3QgbmV3IE1peFdTIn07ZnVuY3Rpb24gYSgpe3IoZS5vcGVuKSYmZS5vcGVuKCl9ZnVuY3Rpb24gYygpe3IoZS5jbG9zZSkmJmUuY2xvc2UoKX1mdW5jdGlvbiBmKHQpe3IoZS5tZXNzYWdlKSYmZS5tZXNzYWdlKHQpfWZ1bmN0aW9uIHModCl7cihlLmVycm9yKSYmZS5lcnJvcih0KSxvLmNsb3NlKCl9cmV0dXJuIHU/KG8ub25vcGVuPWEsby5vbm1lc3NhZ2U9ZnVuY3Rpb24odCl7Zih0LmRhdGEpfSxvLm9uY2xvc2U9YyxvLm9uZXJyb3I9cyk6KG8ub24oIm9wZW4iLGEpLG8ub24oIm1lc3NhZ2UiLGYpLG8ub24oImNsb3NlIixjKSxvLm9uKCJlcnJvciIscykpLG99dD10JiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwiZGVmYXVsdCIpP3QuZGVmYXVsdDp0O3ZhciBvPUFycmF5LmlzQXJyYXksaT0idW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbFRoaXM/Z2xvYmFsVGhpczoidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdz93aW5kb3c6InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWw/Z2xvYmFsOiJ1bmRlZmluZWQiIT10eXBlb2Ygc2VsZj9zZWxmOnt9O2Z1bmN0aW9uIHUodCxuKXtyZXR1cm4gdChuPXtleHBvcnRzOnt9fSxuLmV4cG9ydHMpLG4uZXhwb3J0c312YXIgYT11KChmdW5jdGlvbih0KXtmdW5jdGlvbiBuKHIpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yP3QuZXhwb3J0cz1uPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdH06dC5leHBvcnRzPW49ZnVuY3Rpb24odCl7cmV0dXJuIHQmJiJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJnQuY29uc3RydWN0b3I9PT1TeW1ib2wmJnQhPT1TeW1ib2wucHJvdG90eXBlPyJzeW1ib2wiOnR5cGVvZiB0fSxuKHIpfXQuZXhwb3J0cz1ufSkpLGM9Im9iamVjdCI9PWEoaSkmJmkmJmkuT2JqZWN0PT09T2JqZWN0JiZpLGY9Im9iamVjdCI9PSgidW5kZWZpbmVkIj09dHlwZW9mIHNlbGY/InVuZGVmaW5lZCI6YShzZWxmKSkmJnNlbGYmJnNlbGYuT2JqZWN0PT09T2JqZWN0JiZzZWxmLHM9Y3x8Znx8RnVuY3Rpb24oInJldHVybiB0aGlzIikoKSxsPXMuU3ltYm9sLHY9T2JqZWN0LnByb3RvdHlwZSxwPXYuaGFzT3duUHJvcGVydHksaD12LnRvU3RyaW5nLHk9bD9sLnRvU3RyaW5nVGFnOnZvaWQgMDt2YXIgZD1mdW5jdGlvbih0KXt2YXIgbj1wLmNhbGwodCx5KSxyPXRbeV07dHJ5e3RbeV09dm9pZCAwO3ZhciBlPSEwfWNhdGNoKHQpe312YXIgbz1oLmNhbGwodCk7cmV0dXJuIGUmJihuP3RbeV09cjpkZWxldGUgdFt5XSksb30sZz1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nO3ZhciBiPWZ1bmN0aW9uKHQpe3JldHVybiBnLmNhbGwodCl9LF89bD9sLnRvU3RyaW5nVGFnOnZvaWQgMDt2YXIgbT1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbD09dD92b2lkIDA9PT10PyJbb2JqZWN0IFVuZGVmaW5lZF0iOiJbb2JqZWN0IE51bGxdIjpfJiZfIGluIE9iamVjdCh0KT9kKHQpOmIodCl9O3ZhciBqPWZ1bmN0aW9uKHQpe3JldHVybiBudWxsIT10JiYib2JqZWN0Ij09YSh0KX07dmFyIHc9ZnVuY3Rpb24odCl7cmV0dXJuInN5bWJvbCI9PWEodCl8fGoodCkmJiJbb2JqZWN0IFN5bWJvbF0iPT1tKHQpfSxBPS9cLnxcWyg/OlteW1xdXSp8KFsiJ10pKD86KD8hXDEpW15cXF18XFwuKSo/XDEpXF0vLE89L15cdyokLzt2YXIgeD1mdW5jdGlvbih0LG4pe2lmKG8odCkpcmV0dXJuITE7dmFyIHI9YSh0KTtyZXR1cm4hKCJudW1iZXIiIT1yJiYic3ltYm9sIiE9ciYmImJvb2xlYW4iIT1yJiZudWxsIT10JiYhdyh0KSl8fChPLnRlc3QodCl8fCFBLnRlc3QodCl8fG51bGwhPW4mJnQgaW4gT2JqZWN0KG4pKX07dmFyIFM9ZnVuY3Rpb24odCl7dmFyIG49YSh0KTtyZXR1cm4gbnVsbCE9dCYmKCJvYmplY3QiPT1ufHwiZnVuY3Rpb24iPT1uKX07dmFyIFUsQj1mdW5jdGlvbih0KXtpZighUyh0KSlyZXR1cm4hMTt2YXIgbj1tKHQpO3JldHVybiJbb2JqZWN0IEZ1bmN0aW9uXSI9PW58fCJbb2JqZWN0IEdlbmVyYXRvckZ1bmN0aW9uXSI9PW58fCJbb2JqZWN0IEFzeW5jRnVuY3Rpb25dIj09bnx8IltvYmplY3QgUHJveHldIj09bn0saz1zWyJfX2NvcmUtanNfc2hhcmVkX18iXSxDPShVPS9bXi5dKyQvLmV4ZWMoayYmay5rZXlzJiZrLmtleXMuSUVfUFJPVE98fCIiKSk/IlN5bWJvbChzcmMpXzEuIitVOiIiO3ZhciB6PWZ1bmN0aW9uKHQpe3JldHVybiEhQyYmQyBpbiB0fSxQPUZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZzt2YXIgRT1mdW5jdGlvbih0KXtpZihudWxsIT10KXt0cnl7cmV0dXJuIFAuY2FsbCh0KX1jYXRjaCh0KXt9dHJ5e3JldHVybiB0KyIifWNhdGNoKHQpe319cmV0dXJuIiJ9LEw9L15cW29iamVjdCAuKz9Db25zdHJ1Y3RvclxdJC8sTT1GdW5jdGlvbi5wcm90b3R5cGUsRj1PYmplY3QucHJvdG90eXBlLFQ9TS50b1N0cmluZyxOPUYuaGFzT3duUHJvcGVydHksVz1SZWdFeHAoIl4iK1QuY2FsbChOKS5yZXBsYWNlKC9bXFxeJC4qKz8oKVtcXXt9fF0vZywiXFwkJiIpLnJlcGxhY2UoL2hhc093blByb3BlcnR5fChmdW5jdGlvbikuKj8oPz1cXFwoKXwgZm9yIC4rPyg/PVxcXF0pL2csIiQxLio/IikrIiQiKTt2YXIgST1mdW5jdGlvbih0KXtyZXR1cm4hKCFTKHQpfHx6KHQpKSYmKEIodCk/VzpMKS50ZXN0KEUodCkpfTt2YXIgJD1mdW5jdGlvbih0LG4pe3JldHVybiBudWxsPT10P3ZvaWQgMDp0W25dfTt2YXIgUj1mdW5jdGlvbih0LG4pe3ZhciByPSQodCxuKTtyZXR1cm4gSShyKT9yOnZvaWQgMH0sRD1SKE9iamVjdCwiY3JlYXRlIik7dmFyIEg9ZnVuY3Rpb24oKXt0aGlzLl9fZGF0YV9fPUQ/RChudWxsKTp7fSx0aGlzLnNpemU9MH07dmFyIEc9ZnVuY3Rpb24odCl7dmFyIG49dGhpcy5oYXModCkmJmRlbGV0ZSB0aGlzLl9fZGF0YV9fW3RdO3JldHVybiB0aGlzLnNpemUtPW4/MTowLG59LHE9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTt2YXIgSj1mdW5jdGlvbih0KXt2YXIgbj10aGlzLl9fZGF0YV9fO2lmKEQpe3ZhciByPW5bdF07cmV0dXJuIl9fbG9kYXNoX2hhc2hfdW5kZWZpbmVkX18iPT09cj92b2lkIDA6cn1yZXR1cm4gcS5jYWxsKG4sdCk/blt0XTp2b2lkIDB9LFY9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTt2YXIgSz1mdW5jdGlvbih0KXt2YXIgbj10aGlzLl9fZGF0YV9fO3JldHVybiBEP3ZvaWQgMCE9PW5bdF06Vi5jYWxsKG4sdCl9O3ZhciBRPWZ1bmN0aW9uKHQsbil7dmFyIHI9dGhpcy5fX2RhdGFfXztyZXR1cm4gdGhpcy5zaXplKz10aGlzLmhhcyh0KT8wOjEsclt0XT1EJiZ2b2lkIDA9PT1uPyJfX2xvZGFzaF9oYXNoX3VuZGVmaW5lZF9fIjpuLHRoaXN9O2Z1bmN0aW9uIFgodCl7dmFyIG49LTEscj1udWxsPT10PzA6dC5sZW5ndGg7Zm9yKHRoaXMuY2xlYXIoKTsrK248cjspe3ZhciBlPXRbbl07dGhpcy5zZXQoZVswXSxlWzFdKX19WC5wcm90b3R5cGUuY2xlYXI9SCxYLnByb3RvdHlwZS5kZWxldGU9RyxYLnByb3RvdHlwZS5nZXQ9SixYLnByb3RvdHlwZS5oYXM9SyxYLnByb3RvdHlwZS5zZXQ9UTt2YXIgWT1YO3ZhciBaPWZ1bmN0aW9uKCl7dGhpcy5fX2RhdGFfXz1bXSx0aGlzLnNpemU9MH07dmFyIHR0PWZ1bmN0aW9uKHQsbil7cmV0dXJuIHQ9PT1ufHx0IT10JiZuIT1ufTt2YXIgbnQ9ZnVuY3Rpb24odCxuKXtmb3IodmFyIHI9dC5sZW5ndGg7ci0tOylpZih0dCh0W3JdWzBdLG4pKXJldHVybiByO3JldHVybi0xfSxydD1BcnJheS5wcm90b3R5cGUuc3BsaWNlO3ZhciBldD1mdW5jdGlvbih0KXt2YXIgbj10aGlzLl9fZGF0YV9fLHI9bnQobix0KTtyZXR1cm4hKHI8MCkmJihyPT1uLmxlbmd0aC0xP24ucG9wKCk6cnQuY2FsbChuLHIsMSksLS10aGlzLnNpemUsITApfTt2YXIgb3Q9ZnVuY3Rpb24odCl7dmFyIG49dGhpcy5fX2RhdGFfXyxyPW50KG4sdCk7cmV0dXJuIHI8MD92b2lkIDA6bltyXVsxXX07dmFyIGl0PWZ1bmN0aW9uKHQpe3JldHVybiBudCh0aGlzLl9fZGF0YV9fLHQpPi0xfTt2YXIgdXQ9ZnVuY3Rpb24odCxuKXt2YXIgcj10aGlzLl9fZGF0YV9fLGU9bnQocix0KTtyZXR1cm4gZTwwPygrK3RoaXMuc2l6ZSxyLnB1c2goW3Qsbl0pKTpyW2VdWzFdPW4sdGhpc307ZnVuY3Rpb24gYXQodCl7dmFyIG49LTEscj1udWxsPT10PzA6dC5sZW5ndGg7Zm9yKHRoaXMuY2xlYXIoKTsrK248cjspe3ZhciBlPXRbbl07dGhpcy5zZXQoZVswXSxlWzFdKX19YXQucHJvdG90eXBlLmNsZWFyPVosYXQucHJvdG90eXBlLmRlbGV0ZT1ldCxhdC5wcm90b3R5cGUuZ2V0PW90LGF0LnByb3RvdHlwZS5oYXM9aXQsYXQucHJvdG90eXBlLnNldD11dDt2YXIgY3Q9YXQsZnQ9UihzLCJNYXAiKTt2YXIgc3Q9ZnVuY3Rpb24oKXt0aGlzLnNpemU9MCx0aGlzLl9fZGF0YV9fPXtoYXNoOm5ldyBZLG1hcDpuZXcoZnR8fGN0KSxzdHJpbmc6bmV3IFl9fTt2YXIgbHQ9ZnVuY3Rpb24odCl7dmFyIG49YSh0KTtyZXR1cm4ic3RyaW5nIj09bnx8Im51bWJlciI9PW58fCJzeW1ib2wiPT1ufHwiYm9vbGVhbiI9PW4/Il9fcHJvdG9fXyIhPT10Om51bGw9PT10fTt2YXIgdnQ9ZnVuY3Rpb24odCxuKXt2YXIgcj10Ll9fZGF0YV9fO3JldHVybiBsdChuKT9yWyJzdHJpbmciPT10eXBlb2Ygbj8ic3RyaW5nIjoiaGFzaCJdOnIubWFwfTt2YXIgcHQ9ZnVuY3Rpb24odCl7dmFyIG49dnQodGhpcyx0KS5kZWxldGUodCk7cmV0dXJuIHRoaXMuc2l6ZS09bj8xOjAsbn07dmFyIGh0PWZ1bmN0aW9uKHQpe3JldHVybiB2dCh0aGlzLHQpLmdldCh0KX07dmFyIHl0PWZ1bmN0aW9uKHQpe3JldHVybiB2dCh0aGlzLHQpLmhhcyh0KX07dmFyIGR0PWZ1bmN0aW9uKHQsbil7dmFyIHI9dnQodGhpcyx0KSxlPXIuc2l6ZTtyZXR1cm4gci5zZXQodCxuKSx0aGlzLnNpemUrPXIuc2l6ZT09ZT8wOjEsdGhpc307ZnVuY3Rpb24gZ3QodCl7dmFyIG49LTEscj1udWxsPT10PzA6dC5sZW5ndGg7Zm9yKHRoaXMuY2xlYXIoKTsrK248cjspe3ZhciBlPXRbbl07dGhpcy5zZXQoZVswXSxlWzFdKX19Z3QucHJvdG90eXBlLmNsZWFyPXN0LGd0LnByb3RvdHlwZS5kZWxldGU9cHQsZ3QucHJvdG90eXBlLmdldD1odCxndC5wcm90b3R5cGUuaGFzPXl0LGd0LnByb3RvdHlwZS5zZXQ9ZHQ7dmFyIGJ0PWd0O2Z1bmN0aW9uIF90KHQsbil7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIHR8fG51bGwhPW4mJiJmdW5jdGlvbiIhPXR5cGVvZiBuKXRocm93IG5ldyBUeXBlRXJyb3IoIkV4cGVjdGVkIGEgZnVuY3Rpb24iKTt2YXIgcj1mdW5jdGlvbiByKCl7dmFyIGU9YXJndW1lbnRzLG89bj9uLmFwcGx5KHRoaXMsZSk6ZVswXSxpPXIuY2FjaGU7aWYoaS5oYXMobykpcmV0dXJuIGkuZ2V0KG8pO3ZhciB1PXQuYXBwbHkodGhpcyxlKTtyZXR1cm4gci5jYWNoZT1pLnNldChvLHUpfHxpLHV9O3JldHVybiByLmNhY2hlPW5ldyhfdC5DYWNoZXx8YnQpLHJ9X3QuQ2FjaGU9YnQ7dmFyIG10PV90O3ZhciBqdD0vW14uW1xdXSt8XFsoPzooLT9cZCsoPzpcLlxkKyk/KXwoWyInXSkoKD86KD8hXDIpW15cXF18XFwuKSo/KVwyKVxdfCg/PSg/OlwufFxbXF0pKD86XC58XFtcXXwkKSkvZyx3dD0vXFwoXFwpPy9nLEF0PWZ1bmN0aW9uKHQpe3ZhciBuPW10KHQsKGZ1bmN0aW9uKHQpe3JldHVybiA1MDA9PT1yLnNpemUmJnIuY2xlYXIoKSx0fSkpLHI9bi5jYWNoZTtyZXR1cm4gbn0oKGZ1bmN0aW9uKHQpe3ZhciBuPVtdO3JldHVybiA0Nj09PXQuY2hhckNvZGVBdCgwKSYmbi5wdXNoKCIiKSx0LnJlcGxhY2UoanQsKGZ1bmN0aW9uKHQscixlLG8pe24ucHVzaChlP28ucmVwbGFjZSh3dCwiJDEiKTpyfHx0KX0pKSxufSkpO3ZhciBPdD1mdW5jdGlvbih0LG4pe2Zvcih2YXIgcj0tMSxlPW51bGw9PXQ/MDp0Lmxlbmd0aCxvPUFycmF5KGUpOysrcjxlOylvW3JdPW4odFtyXSxyLHQpO3JldHVybiBvfSx4dD1sP2wucHJvdG90eXBlOnZvaWQgMCxTdD14dD94dC50b1N0cmluZzp2b2lkIDA7dmFyIFV0PWZ1bmN0aW9uIHQobil7aWYoInN0cmluZyI9PXR5cGVvZiBuKXJldHVybiBuO2lmKG8obikpcmV0dXJuIE90KG4sdCkrIiI7aWYodyhuKSlyZXR1cm4gU3Q/U3QuY2FsbChuKToiIjt2YXIgcj1uKyIiO3JldHVybiIwIj09ciYmMS9uPT0tMS8wPyItMCI6cn07dmFyIEJ0PWZ1bmN0aW9uKHQpe3JldHVybiBudWxsPT10PyIiOlV0KHQpfTt2YXIga3Q9ZnVuY3Rpb24odCxuKXtyZXR1cm4gbyh0KT90OngodCxuKT9bdF06QXQoQnQodCkpfTt2YXIgQ3Q9ZnVuY3Rpb24odCl7aWYoInN0cmluZyI9PXR5cGVvZiB0fHx3KHQpKXJldHVybiB0O3ZhciBuPXQrIiI7cmV0dXJuIjAiPT1uJiYxL3Q9PS0xLzA/Ii0wIjpufTt2YXIgenQ9ZnVuY3Rpb24odCxuKXtmb3IodmFyIHI9MCxlPShuPWt0KG4sdCkpLmxlbmd0aDtudWxsIT10JiZyPGU7KXQ9dFtDdChuW3IrK10pXTtyZXR1cm4gciYmcj09ZT90OnZvaWQgMH07dmFyIFB0PWZ1bmN0aW9uKHQsbixyKXt2YXIgZT1udWxsPT10P3ZvaWQgMDp6dCh0LG4pO3JldHVybiB2b2lkIDA9PT1lP3I6ZX07ZnVuY3Rpb24gRXQoKXt2YXIgdCxuLHI9bmV3IFByb21pc2UoKGZ1bmN0aW9uKCl7dD1hcmd1bWVudHNbMF0sbj1hcmd1bWVudHNbMV19KSk7cmV0dXJuIHIucmVzb2x2ZT10LHIucmVqZWN0PW4scn12YXIgTHQ9L15ccyt8XHMrJC9nLE10PS9eWy0rXTB4WzAtOWEtZl0rJC9pLEZ0PS9eMGJbMDFdKyQvaSxUdD0vXjBvWzAtN10rJC9pLE50PXBhcnNlSW50O3ZhciBXdD1mdW5jdGlvbih0KXtpZigibnVtYmVyIj09dHlwZW9mIHQpcmV0dXJuIHQ7aWYodyh0KSlyZXR1cm4gTmFOO2lmKFModCkpe3ZhciBuPSJmdW5jdGlvbiI9PXR5cGVvZiB0LnZhbHVlT2Y/dC52YWx1ZU9mKCk6dDt0PVMobik/bisiIjpufWlmKCJzdHJpbmciIT10eXBlb2YgdClyZXR1cm4gMD09PXQ/dDordDt0PXQucmVwbGFjZShMdCwiIik7dmFyIHI9RnQudGVzdCh0KTtyZXR1cm4gcnx8VHQudGVzdCh0KT9OdCh0LnNsaWNlKDIpLHI/Mjo4KTpNdC50ZXN0KHQpP05hTjordH07dmFyIEl0PWZ1bmN0aW9uKHQpe3JldHVybiB0Pyh0PVd0KHQpKT09PTEvMHx8dD09PS0xLzA/MTc5NzY5MzEzNDg2MjMxNTdlMjkyKih0PDA/LTE6MSk6dD09dD90OjA6MD09PXQ/dDowfTt2YXIgJHQ9ZnVuY3Rpb24odCl7dmFyIG49SXQodCkscj1uJTE7cmV0dXJuIG49PW4/cj9uLXI6bjowfTt2YXIgUnQ9ZnVuY3Rpb24odCl7cmV0dXJuIm51bWJlciI9PXR5cGVvZiB0JiZ0PT0kdCh0KX07ZnVuY3Rpb24gRHQodCl7cmV0dXJuIltvYmplY3QgU3RyaW5nXSI9PT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCl9ZnVuY3Rpb24gSHQodCl7cmV0dXJuISghRHQodCl8fCIiPT09dCl9ZnVuY3Rpb24gR3QodCl7dmFyIG49ITE7cmV0dXJuIEh0KHQpP249IWlzTmFOKE51bWJlcih0KSk6ZnVuY3Rpb24odCl7cmV0dXJuIltvYmplY3QgTnVtYmVyXSI9PT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCl9KHQpJiYobj0hMCksbn1mdW5jdGlvbiBxdCh0KXtyZXR1cm4gR3QodCk/SXQodCk6MH12YXIgSnQ9cy5pc0Zpbml0ZSxWdD1NYXRoLm1pbjt2YXIgS3Q9ZnVuY3Rpb24odCl7dmFyIG49TWF0aFt0XTtyZXR1cm4gZnVuY3Rpb24odCxyKXtpZih0PVd0KHQpLChyPW51bGw9PXI/MDpWdCgkdChyKSwyOTIpKSYmSnQodCkpe3ZhciBlPShCdCh0KSsiZSIpLnNwbGl0KCJlIiksbz1uKGVbMF0rImUiKygrZVsxXStyKSk7cmV0dXJuKygoZT0oQnQobykrImUiKS5zcGxpdCgiZSIpKVswXSsiZSIrKCtlWzFdLXIpKX1yZXR1cm4gbih0KX19KCJyb3VuZCIpO2Z1bmN0aW9uIFF0KHQpe2lmKCFHdCh0KSlyZXR1cm4gMDt0PXF0KHQpO3ZhciBuPUt0KHQpO3JldHVybiIwIj09PVN0cmluZyhuKT8wOm59ZnVuY3Rpb24gWHQodCl7cmV0dXJuISFmdW5jdGlvbih0KXtyZXR1cm4hIUd0KHQpJiYodD1xdCh0KSxSdCh0KSl9KHQpJiZRdCh0KT4wfXZhciBZdD0iMDEyMzQ1Njc4OUFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiLnNwbGl0KCIiKSxadD1ZdC5sZW5ndGg7ZnVuY3Rpb24gdG4oKXt2YXIgdD1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06MzIsbj1bXTt0PVh0KHQpP1F0KHQpOjMyO2Zvcih2YXIgcj0wO3I8dDtyKyspbltyXT1ZdFswfE1hdGgucmFuZG9tKCkqWnRdO3ZhciBlPW4uam9pbigiIik7cmV0dXJuIGV9dmFyIG5uPXUoKGZ1bmN0aW9uKHQpe3ZhciBuPU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkscj0ifiI7ZnVuY3Rpb24gZSgpe31mdW5jdGlvbiBvKHQsbixyKXt0aGlzLmZuPXQsdGhpcy5jb250ZXh0PW4sdGhpcy5vbmNlPXJ8fCExfWZ1bmN0aW9uIGkodCxuLGUsaSx1KXtpZigiZnVuY3Rpb24iIT10eXBlb2YgZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJUaGUgbGlzdGVuZXIgbXVzdCBiZSBhIGZ1bmN0aW9uIik7dmFyIGE9bmV3IG8oZSxpfHx0LHUpLGM9cj9yK246bjtyZXR1cm4gdC5fZXZlbnRzW2NdP3QuX2V2ZW50c1tjXS5mbj90Ll9ldmVudHNbY109W3QuX2V2ZW50c1tjXSxhXTp0Ll9ldmVudHNbY10ucHVzaChhKToodC5fZXZlbnRzW2NdPWEsdC5fZXZlbnRzQ291bnQrKyksdH1mdW5jdGlvbiB1KHQsbil7MD09LS10Ll9ldmVudHNDb3VudD90Ll9ldmVudHM9bmV3IGU6ZGVsZXRlIHQuX2V2ZW50c1tuXX1mdW5jdGlvbiBhKCl7dGhpcy5fZXZlbnRzPW5ldyBlLHRoaXMuX2V2ZW50c0NvdW50PTB9T2JqZWN0LmNyZWF0ZSYmKGUucHJvdG90eXBlPU9iamVjdC5jcmVhdGUobnVsbCksKG5ldyBlKS5fX3Byb3RvX198fChyPSExKSksYS5wcm90b3R5cGUuZXZlbnROYW1lcz1mdW5jdGlvbigpe3ZhciB0LGUsbz1bXTtpZigwPT09dGhpcy5fZXZlbnRzQ291bnQpcmV0dXJuIG87Zm9yKGUgaW4gdD10aGlzLl9ldmVudHMpbi5jYWxsKHQsZSkmJm8ucHVzaChyP2Uuc2xpY2UoMSk6ZSk7cmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM/by5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyh0KSk6b30sYS5wcm90b3R5cGUubGlzdGVuZXJzPWZ1bmN0aW9uKHQpe3ZhciBuPXI/cit0OnQsZT10aGlzLl9ldmVudHNbbl07aWYoIWUpcmV0dXJuW107aWYoZS5mbilyZXR1cm5bZS5mbl07Zm9yKHZhciBvPTAsaT1lLmxlbmd0aCx1PW5ldyBBcnJheShpKTtvPGk7bysrKXVbb109ZVtvXS5mbjtyZXR1cm4gdX0sYS5wcm90b3R5cGUubGlzdGVuZXJDb3VudD1mdW5jdGlvbih0KXt2YXIgbj1yP3IrdDp0LGU9dGhpcy5fZXZlbnRzW25dO3JldHVybiBlP2UuZm4/MTplLmxlbmd0aDowfSxhLnByb3RvdHlwZS5lbWl0PWZ1bmN0aW9uKHQsbixlLG8saSx1KXt2YXIgYT1yP3IrdDp0O2lmKCF0aGlzLl9ldmVudHNbYV0pcmV0dXJuITE7dmFyIGMsZixzPXRoaXMuX2V2ZW50c1thXSxsPWFyZ3VtZW50cy5sZW5ndGg7aWYocy5mbil7c3dpdGNoKHMub25jZSYmdGhpcy5yZW1vdmVMaXN0ZW5lcih0LHMuZm4sdm9pZCAwLCEwKSxsKXtjYXNlIDE6cmV0dXJuIHMuZm4uY2FsbChzLmNvbnRleHQpLCEwO2Nhc2UgMjpyZXR1cm4gcy5mbi5jYWxsKHMuY29udGV4dCxuKSwhMDtjYXNlIDM6cmV0dXJuIHMuZm4uY2FsbChzLmNvbnRleHQsbixlKSwhMDtjYXNlIDQ6cmV0dXJuIHMuZm4uY2FsbChzLmNvbnRleHQsbixlLG8pLCEwO2Nhc2UgNTpyZXR1cm4gcy5mbi5jYWxsKHMuY29udGV4dCxuLGUsbyxpKSwhMDtjYXNlIDY6cmV0dXJuIHMuZm4uY2FsbChzLmNvbnRleHQsbixlLG8saSx1KSwhMH1mb3IoZj0xLGM9bmV3IEFycmF5KGwtMSk7ZjxsO2YrKyljW2YtMV09YXJndW1lbnRzW2ZdO3MuZm4uYXBwbHkocy5jb250ZXh0LGMpfWVsc2V7dmFyIHYscD1zLmxlbmd0aDtmb3IoZj0wO2Y8cDtmKyspc3dpdGNoKHNbZl0ub25jZSYmdGhpcy5yZW1vdmVMaXN0ZW5lcih0LHNbZl0uZm4sdm9pZCAwLCEwKSxsKXtjYXNlIDE6c1tmXS5mbi5jYWxsKHNbZl0uY29udGV4dCk7YnJlYWs7Y2FzZSAyOnNbZl0uZm4uY2FsbChzW2ZdLmNvbnRleHQsbik7YnJlYWs7Y2FzZSAzOnNbZl0uZm4uY2FsbChzW2ZdLmNvbnRleHQsbixlKTticmVhaztjYXNlIDQ6c1tmXS5mbi5jYWxsKHNbZl0uY29udGV4dCxuLGUsbyk7YnJlYWs7ZGVmYXVsdDppZighYylmb3Iodj0xLGM9bmV3IEFycmF5KGwtMSk7djxsO3YrKyljW3YtMV09YXJndW1lbnRzW3ZdO3NbZl0uZm4uYXBwbHkoc1tmXS5jb250ZXh0LGMpfX1yZXR1cm4hMH0sYS5wcm90b3R5cGUub249ZnVuY3Rpb24odCxuLHIpe3JldHVybiBpKHRoaXMsdCxuLHIsITEpfSxhLnByb3RvdHlwZS5vbmNlPWZ1bmN0aW9uKHQsbixyKXtyZXR1cm4gaSh0aGlzLHQsbixyLCEwKX0sYS5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXI9ZnVuY3Rpb24odCxuLGUsbyl7dmFyIGk9cj9yK3Q6dDtpZighdGhpcy5fZXZlbnRzW2ldKXJldHVybiB0aGlzO2lmKCFuKXJldHVybiB1KHRoaXMsaSksdGhpczt2YXIgYT10aGlzLl9ldmVudHNbaV07aWYoYS5mbilhLmZuIT09bnx8byYmIWEub25jZXx8ZSYmYS5jb250ZXh0IT09ZXx8dSh0aGlzLGkpO2Vsc2V7Zm9yKHZhciBjPTAsZj1bXSxzPWEubGVuZ3RoO2M8cztjKyspKGFbY10uZm4hPT1ufHxvJiYhYVtjXS5vbmNlfHxlJiZhW2NdLmNvbnRleHQhPT1lKSYmZi5wdXNoKGFbY10pO2YubGVuZ3RoP3RoaXMuX2V2ZW50c1tpXT0xPT09Zi5sZW5ndGg/ZlswXTpmOnUodGhpcyxpKX1yZXR1cm4gdGhpc30sYS5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzPWZ1bmN0aW9uKHQpe3ZhciBuO3JldHVybiB0PyhuPXI/cit0OnQsdGhpcy5fZXZlbnRzW25dJiZ1KHRoaXMsbikpOih0aGlzLl9ldmVudHM9bmV3IGUsdGhpcy5fZXZlbnRzQ291bnQ9MCksdGhpc30sYS5wcm90b3R5cGUub2ZmPWEucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyLGEucHJvdG90eXBlLmFkZExpc3RlbmVyPWEucHJvdG90eXBlLm9uLGEucHJlZml4ZWQ9cixhLkV2ZW50RW1pdHRlcj1hLHQuZXhwb3J0cz1hfSkpO2Z1bmN0aW9uIHJuKCl7cmV0dXJuIG5ldyBubn12YXIgZW49ZnVuY3Rpb24odCxuLHIpe3ZhciBlPS0xLG89dC5sZW5ndGg7bjwwJiYobj0tbj5vPzA6bytuKSwocj1yPm8/bzpyKTwwJiYocis9byksbz1uPnI/MDpyLW4+Pj4wLG4+Pj49MDtmb3IodmFyIGk9QXJyYXkobyk7KytlPG87KWlbZV09dFtlK25dO3JldHVybiBpfTt2YXIgb249ZnVuY3Rpb24odCl7cmV0dXJuIm51bWJlciI9PXR5cGVvZiB0JiZ0Pi0xJiZ0JTE9PTAmJnQ8PTkwMDcxOTkyNTQ3NDA5OTF9O3ZhciB1bj1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbCE9dCYmb24odC5sZW5ndGgpJiYhQih0KX0sYW49L14oPzowfFsxLTldXGQqKSQvO3ZhciBjbj1mdW5jdGlvbih0LG4pe3ZhciByPWEodCk7cmV0dXJuISEobj1udWxsPT1uPzkwMDcxOTkyNTQ3NDA5OTE6bikmJigibnVtYmVyIj09cnx8InN5bWJvbCIhPXImJmFuLnRlc3QodCkpJiZ0Pi0xJiZ0JTE9PTAmJnQ8bn07dmFyIGZuPWZ1bmN0aW9uKHQsbixyKXtpZighUyhyKSlyZXR1cm4hMTt2YXIgZT1hKG4pO3JldHVybiEhKCJudW1iZXIiPT1lP3VuKHIpJiZjbihuLHIubGVuZ3RoKToic3RyaW5nIj09ZSYmbiBpbiByKSYmdHQocltuXSx0KX0sc249TWF0aC5jZWlsLGxuPU1hdGgubWF4O3ZhciB2bj1mdW5jdGlvbih0LG4scil7bj0ocj9mbih0LG4scik6dm9pZCAwPT09bik/MTpsbigkdChuKSwwKTt2YXIgZT1udWxsPT10PzA6dC5sZW5ndGg7aWYoIWV8fG48MSlyZXR1cm5bXTtmb3IodmFyIG89MCxpPTAsdT1BcnJheShzbihlL24pKTtvPGU7KXVbaSsrXT1lbih0LG8sbys9bik7cmV0dXJuIHV9LHBuPUFycmF5LnByb3RvdHlwZS5qb2luO3ZhciBobj1mdW5jdGlvbih0LG4pe3JldHVybiBudWxsPT10PyIiOnBuLmNhbGwodCxuKX07dmFyIHluPWZ1bmN0aW9uKHQsbil7Zm9yKHZhciByPS0xLGU9bnVsbD09dD8wOnQubGVuZ3RoOysrcjxlJiYhMSE9PW4odFtyXSxyLHQpOyk7cmV0dXJuIHR9O3ZhciBkbj1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24obixyLGUpe2Zvcih2YXIgbz0tMSxpPU9iamVjdChuKSx1PWUobiksYT11Lmxlbmd0aDthLS07KXt2YXIgYz11W3Q/YTorK29dO2lmKCExPT09cihpW2NdLGMsaSkpYnJlYWt9cmV0dXJuIG59fSgpO3ZhciBnbj1mdW5jdGlvbih0LG4pe2Zvcih2YXIgcj0tMSxlPUFycmF5KHQpOysrcjx0OyllW3JdPW4ocik7cmV0dXJuIGV9O3ZhciBibj1mdW5jdGlvbih0KXtyZXR1cm4gaih0KSYmIltvYmplY3QgQXJndW1lbnRzXSI9PW0odCl9LF9uPU9iamVjdC5wcm90b3R5cGUsbW49X24uaGFzT3duUHJvcGVydHksam49X24ucHJvcGVydHlJc0VudW1lcmFibGUsd249Ym4oZnVuY3Rpb24oKXtyZXR1cm4gYXJndW1lbnRzfSgpKT9ibjpmdW5jdGlvbih0KXtyZXR1cm4gaih0KSYmbW4uY2FsbCh0LCJjYWxsZWUiKSYmIWpuLmNhbGwodCwiY2FsbGVlIil9O3ZhciBBbj1mdW5jdGlvbigpe3JldHVybiExfSxPbj11KChmdW5jdGlvbih0LG4pe3ZhciByPW4mJiFuLm5vZGVUeXBlJiZuLGU9ciYmdCYmIXQubm9kZVR5cGUmJnQsbz1lJiZlLmV4cG9ydHM9PT1yP3MuQnVmZmVyOnZvaWQgMCxpPShvP28uaXNCdWZmZXI6dm9pZCAwKXx8QW47dC5leHBvcnRzPWl9KSkseG49e307eG5bIltvYmplY3QgRmxvYXQzMkFycmF5XSJdPXhuWyJbb2JqZWN0IEZsb2F0NjRBcnJheV0iXT14blsiW29iamVjdCBJbnQ4QXJyYXldIl09eG5bIltvYmplY3QgSW50MTZBcnJheV0iXT14blsiW29iamVjdCBJbnQzMkFycmF5XSJdPXhuWyJbb2JqZWN0IFVpbnQ4QXJyYXldIl09eG5bIltvYmplY3QgVWludDhDbGFtcGVkQXJyYXldIl09eG5bIltvYmplY3QgVWludDE2QXJyYXldIl09eG5bIltvYmplY3QgVWludDMyQXJyYXldIl09ITAseG5bIltvYmplY3QgQXJndW1lbnRzXSJdPXhuWyJbb2JqZWN0IEFycmF5XSJdPXhuWyJbb2JqZWN0IEFycmF5QnVmZmVyXSJdPXhuWyJbb2JqZWN0IEJvb2xlYW5dIl09eG5bIltvYmplY3QgRGF0YVZpZXddIl09eG5bIltvYmplY3QgRGF0ZV0iXT14blsiW29iamVjdCBFcnJvcl0iXT14blsiW29iamVjdCBGdW5jdGlvbl0iXT14blsiW29iamVjdCBNYXBdIl09eG5bIltvYmplY3QgTnVtYmVyXSJdPXhuWyJbb2JqZWN0IE9iamVjdF0iXT14blsiW29iamVjdCBSZWdFeHBdIl09eG5bIltvYmplY3QgU2V0XSJdPXhuWyJbb2JqZWN0IFN0cmluZ10iXT14blsiW29iamVjdCBXZWFrTWFwXSJdPSExO3ZhciBTbj1mdW5jdGlvbih0KXtyZXR1cm4gaih0KSYmb24odC5sZW5ndGgpJiYhIXhuW20odCldfTt2YXIgVW49ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiB0KG4pfX0sQm49dSgoZnVuY3Rpb24odCxuKXt2YXIgcj1uJiYhbi5ub2RlVHlwZSYmbixlPXImJnQmJiF0Lm5vZGVUeXBlJiZ0LG89ZSYmZS5leHBvcnRzPT09ciYmYy5wcm9jZXNzLGk9ZnVuY3Rpb24oKXt0cnl7dmFyIHQ9ZSYmZS5yZXF1aXJlJiZlLnJlcXVpcmUoInV0aWwiKS50eXBlcztyZXR1cm4gdHx8byYmby5iaW5kaW5nJiZvLmJpbmRpbmcoInV0aWwiKX1jYXRjaCh0KXt9fSgpO3QuZXhwb3J0cz1pfSkpLGtuPUJuJiZCbi5pc1R5cGVkQXJyYXksQ249a24/VW4oa24pOlNuLHpuPU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7dmFyIFBuPWZ1bmN0aW9uKHQsbil7dmFyIHI9byh0KSxlPSFyJiZ3bih0KSxpPSFyJiYhZSYmT24odCksdT0hciYmIWUmJiFpJiZDbih0KSxhPXJ8fGV8fGl8fHUsYz1hP2duKHQubGVuZ3RoLFN0cmluZyk6W10sZj1jLmxlbmd0aDtmb3IodmFyIHMgaW4gdCkhbiYmIXpuLmNhbGwodCxzKXx8YSYmKCJsZW5ndGgiPT1zfHxpJiYoIm9mZnNldCI9PXN8fCJwYXJlbnQiPT1zKXx8dSYmKCJidWZmZXIiPT1zfHwiYnl0ZUxlbmd0aCI9PXN8fCJieXRlT2Zmc2V0Ij09cyl8fGNuKHMsZikpfHxjLnB1c2gocyk7cmV0dXJuIGN9LEVuPU9iamVjdC5wcm90b3R5cGU7dmFyIExuPWZ1bmN0aW9uKHQpe3ZhciBuPXQmJnQuY29uc3RydWN0b3I7cmV0dXJuIHQ9PT0oImZ1bmN0aW9uIj09dHlwZW9mIG4mJm4ucHJvdG90eXBlfHxFbil9O3ZhciBNbj1mdW5jdGlvbih0LG4pe3JldHVybiBmdW5jdGlvbihyKXtyZXR1cm4gdChuKHIpKX19KE9iamVjdC5rZXlzLE9iamVjdCksRm49T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTt2YXIgVG49ZnVuY3Rpb24odCl7aWYoIUxuKHQpKXJldHVybiBNbih0KTt2YXIgbj1bXTtmb3IodmFyIHIgaW4gT2JqZWN0KHQpKUZuLmNhbGwodCxyKSYmImNvbnN0cnVjdG9yIiE9ciYmbi5wdXNoKHIpO3JldHVybiBufTt2YXIgTm49ZnVuY3Rpb24odCl7cmV0dXJuIHVuKHQpP1BuKHQpOlRuKHQpfTt2YXIgV249ZnVuY3Rpb24odCxuKXtyZXR1cm4gZnVuY3Rpb24ocixlKXtpZihudWxsPT1yKXJldHVybiByO2lmKCF1bihyKSlyZXR1cm4gdChyLGUpO2Zvcih2YXIgbz1yLmxlbmd0aCxpPW4/bzotMSx1PU9iamVjdChyKTsobj9pLS06KytpPG8pJiYhMSE9PWUodVtpXSxpLHUpOyk7cmV0dXJuIHJ9fSgoZnVuY3Rpb24odCxuKXtyZXR1cm4gdCYmZG4odCxuLE5uKX0pKTt2YXIgSW49ZnVuY3Rpb24odCl7cmV0dXJuIHR9O3ZhciAkbj1mdW5jdGlvbih0KXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgdD90OklufTt2YXIgUm49ZnVuY3Rpb24odCxuKXtyZXR1cm4obyh0KT95bjpXbikodCwkbihuKSl9O2Z1bmN0aW9uIERuKHQpe3JldHVybiJbb2JqZWN0IFVpbnQ4QXJyYXldIj09PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0KX1mdW5jdGlvbiBIbih0KXtyZXR1cm4iW29iamVjdCBVaW50MTZBcnJheV0iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpfWZ1bmN0aW9uIEduKHQsbil7cmV0dXJuIEh0KHQpJiZYdChuKT90LnN1YnN0cigwLG4pOiIifWZ1bmN0aW9uIHFuKHQsbil7cmV0dXJuIEh0KHQpJiZYdChuKT9mdW5jdGlvbih0LG4pe2lmKCFIdCh0KSlyZXR1cm4iIjtpZighWHQobikpcmV0dXJuIiI7dmFyIHI9dC5sZW5ndGgtbjtyZXR1cm4gcjwwJiYocj0wKSx0LnN1YnN0cihyLG4pfSh0LHQubGVuZ3RoLW4pOiIifXZhciBKbj11KChmdW5jdGlvbih0LG4pe3ZhciByO3QuZXhwb3J0cz0ocj1yfHxmdW5jdGlvbih0LG4pe3ZhciByPU9iamVjdC5jcmVhdGV8fGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gZnVuY3Rpb24obil7dmFyIHI7cmV0dXJuIHQucHJvdG90eXBlPW4scj1uZXcgdCx0LnByb3RvdHlwZT1udWxsLHJ9fSgpLGU9e30sbz1lLmxpYj17fSxpPW8uQmFzZT17ZXh0ZW5kOmZ1bmN0aW9uKHQpe3ZhciBuPXIodGhpcyk7cmV0dXJuIHQmJm4ubWl4SW4odCksbi5oYXNPd25Qcm9wZXJ0eSgiaW5pdCIpJiZ0aGlzLmluaXQhPT1uLmluaXR8fChuLmluaXQ9ZnVuY3Rpb24oKXtuLiRzdXBlci5pbml0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pLG4uaW5pdC5wcm90b3R5cGU9bixuLiRzdXBlcj10aGlzLG59LGNyZWF0ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZXh0ZW5kKCk7cmV0dXJuIHQuaW5pdC5hcHBseSh0LGFyZ3VtZW50cyksdH0saW5pdDpmdW5jdGlvbigpe30sbWl4SW46ZnVuY3Rpb24odCl7Zm9yKHZhciBuIGluIHQpdC5oYXNPd25Qcm9wZXJ0eShuKSYmKHRoaXNbbl09dFtuXSk7dC5oYXNPd25Qcm9wZXJ0eSgidG9TdHJpbmciKSYmKHRoaXMudG9TdHJpbmc9dC50b1N0cmluZyl9LGNsb25lOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaW5pdC5wcm90b3R5cGUuZXh0ZW5kKHRoaXMpfX0sdT1vLldvcmRBcnJheT1pLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0LG4pe3Q9dGhpcy53b3Jkcz10fHxbXSx0aGlzLnNpZ0J5dGVzPW51bGwhPW4/bjo0KnQubGVuZ3RofSx0b1N0cmluZzpmdW5jdGlvbih0KXtyZXR1cm4odHx8Yykuc3RyaW5naWZ5KHRoaXMpfSxjb25jYXQ6ZnVuY3Rpb24odCl7dmFyIG49dGhpcy53b3JkcyxyPXQud29yZHMsZT10aGlzLnNpZ0J5dGVzLG89dC5zaWdCeXRlcztpZih0aGlzLmNsYW1wKCksZSU0KWZvcih2YXIgaT0wO2k8bztpKyspe3ZhciB1PXJbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O25bZStpPj4+Ml18PXU8PDI0LShlK2kpJTQqOH1lbHNlIGZvcihpPTA7aTxvO2krPTQpbltlK2k+Pj4yXT1yW2k+Pj4yXTtyZXR1cm4gdGhpcy5zaWdCeXRlcys9byx0aGlzfSxjbGFtcDpmdW5jdGlvbigpe3ZhciBuPXRoaXMud29yZHMscj10aGlzLnNpZ0J5dGVzO25bcj4+PjJdJj00Mjk0OTY3Mjk1PDwzMi1yJTQqOCxuLmxlbmd0aD10LmNlaWwoci80KX0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1pLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQud29yZHM9dGhpcy53b3Jkcy5zbGljZSgwKSx0fSxyYW5kb206ZnVuY3Rpb24obil7Zm9yKHZhciByLGU9W10sbz1mdW5jdGlvbihuKXtuPW47dmFyIHI9OTg3NjU0MzIxLGU9NDI5NDk2NzI5NTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgbz0oKHI9MzY5NjkqKDY1NTM1JnIpKyhyPj4xNikmZSk8PDE2KSsobj0xOGUzKig2NTUzNSZuKSsobj4+MTYpJmUpJmU7cmV0dXJuIG8vPTQyOTQ5NjcyOTYsKG8rPS41KSoodC5yYW5kb20oKT4uNT8xOi0xKX19LGk9MDtpPG47aSs9NCl7dmFyIGE9byg0Mjk0OTY3Mjk2KihyfHx0LnJhbmRvbSgpKSk7cj05ODc2NTQwNzEqYSgpLGUucHVzaCg0Mjk0OTY3Mjk2KmEoKXwwKX1yZXR1cm4gbmV3IHUuaW5pdChlLG4pfX0pLGE9ZS5lbmM9e30sYz1hLkhleD17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe2Zvcih2YXIgbj10LndvcmRzLHI9dC5zaWdCeXRlcyxlPVtdLG89MDtvPHI7bysrKXt2YXIgaT1uW28+Pj4yXT4+PjI0LW8lNCo4JjI1NTtlLnB1c2goKGk+Pj40KS50b1N0cmluZygxNikpLGUucHVzaCgoMTUmaSkudG9TdHJpbmcoMTYpKX1yZXR1cm4gZS5qb2luKCIiKX0scGFyc2U6ZnVuY3Rpb24odCl7Zm9yKHZhciBuPXQubGVuZ3RoLHI9W10sZT0wO2U8bjtlKz0yKXJbZT4+PjNdfD1wYXJzZUludCh0LnN1YnN0cihlLDIpLDE2KTw8MjQtZSU4KjQ7cmV0dXJuIG5ldyB1LmluaXQocixuLzIpfX0sZj1hLkxhdGluMT17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe2Zvcih2YXIgbj10LndvcmRzLHI9dC5zaWdCeXRlcyxlPVtdLG89MDtvPHI7bysrKXt2YXIgaT1uW28+Pj4yXT4+PjI0LW8lNCo4JjI1NTtlLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShpKSl9cmV0dXJuIGUuam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe2Zvcih2YXIgbj10Lmxlbmd0aCxyPVtdLGU9MDtlPG47ZSsrKXJbZT4+PjJdfD0oMjU1JnQuY2hhckNvZGVBdChlKSk8PDI0LWUlNCo4O3JldHVybiBuZXcgdS5pbml0KHIsbil9fSxzPWEuVXRmOD17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3RyeXtyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZShmLnN0cmluZ2lmeSh0KSkpfWNhdGNoKHQpe3Rocm93IG5ldyBFcnJvcigiTWFsZm9ybWVkIFVURi04IGRhdGEiKX19LHBhcnNlOmZ1bmN0aW9uKHQpe3JldHVybiBmLnBhcnNlKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudCh0KSkpfX0sbD1vLkJ1ZmZlcmVkQmxvY2tBbGdvcml0aG09aS5leHRlbmQoe3Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5fZGF0YT1uZXcgdS5pbml0LHRoaXMuX25EYXRhQnl0ZXM9MH0sX2FwcGVuZDpmdW5jdGlvbih0KXsic3RyaW5nIj09dHlwZW9mIHQmJih0PXMucGFyc2UodCkpLHRoaXMuX2RhdGEuY29uY2F0KHQpLHRoaXMuX25EYXRhQnl0ZXMrPXQuc2lnQnl0ZXN9LF9wcm9jZXNzOmZ1bmN0aW9uKG4pe3ZhciByPXRoaXMuX2RhdGEsZT1yLndvcmRzLG89ci5zaWdCeXRlcyxpPXRoaXMuYmxvY2tTaXplLGE9by8oNCppKSxjPShhPW4/dC5jZWlsKGEpOnQubWF4KCgwfGEpLXRoaXMuX21pbkJ1ZmZlclNpemUsMCkpKmksZj10Lm1pbig0KmMsbyk7aWYoYyl7Zm9yKHZhciBzPTA7czxjO3MrPWkpdGhpcy5fZG9Qcm9jZXNzQmxvY2soZSxzKTt2YXIgbD1lLnNwbGljZSgwLGMpO3Iuc2lnQnl0ZXMtPWZ9cmV0dXJuIG5ldyB1LmluaXQobCxmKX0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1pLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2RhdGE9dGhpcy5fZGF0YS5jbG9uZSgpLHR9LF9taW5CdWZmZXJTaXplOjB9KSx2PShvLkhhc2hlcj1sLmV4dGVuZCh7Y2ZnOmkuZXh0ZW5kKCksaW5pdDpmdW5jdGlvbih0KXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQodCksdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe2wucmVzZXQuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9LHVwZGF0ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fYXBwZW5kKHQpLHRoaXMuX3Byb2Nlc3MoKSx0aGlzfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmdGhpcy5fYXBwZW5kKHQpLHRoaXMuX2RvRmluYWxpemUoKX0sYmxvY2tTaXplOjE2LF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKG4scil7cmV0dXJuIG5ldyB0LmluaXQocikuZmluYWxpemUobil9fSxfY3JlYXRlSG1hY0hlbHBlcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24obixyKXtyZXR1cm4gbmV3IHYuSE1BQy5pbml0KHQscikuZmluYWxpemUobil9fX0pLGUuYWxnbz17fSk7cmV0dXJuIGV9KE1hdGgpLHIpfSkpLFZuPXUoKGZ1bmN0aW9uKHQsbil7dmFyIHIsZSxvO3QuZXhwb3J0cz0oZT0ocj1vPUpuKS5saWIuV29yZEFycmF5LHIuZW5jLkJhc2U2ND17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3ZhciBuPXQud29yZHMscj10LnNpZ0J5dGVzLGU9dGhpcy5fbWFwO3QuY2xhbXAoKTtmb3IodmFyIG89W10saT0wO2k8cjtpKz0zKWZvcih2YXIgdT0obltpPj4+Ml0+Pj4yNC1pJTQqOCYyNTUpPDwxNnwobltpKzE+Pj4yXT4+PjI0LShpKzEpJTQqOCYyNTUpPDw4fG5baSsyPj4+Ml0+Pj4yNC0oaSsyKSU0KjgmMjU1LGE9MDthPDQmJmkrLjc1KmE8cjthKyspby5wdXNoKGUuY2hhckF0KHU+Pj42KigzLWEpJjYzKSk7dmFyIGM9ZS5jaGFyQXQoNjQpO2lmKGMpZm9yKDtvLmxlbmd0aCU0OylvLnB1c2goYyk7cmV0dXJuIG8uam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe3ZhciBuPXQubGVuZ3RoLHI9dGhpcy5fbWFwLG89dGhpcy5fcmV2ZXJzZU1hcDtpZighbyl7bz10aGlzLl9yZXZlcnNlTWFwPVtdO2Zvcih2YXIgaT0wO2k8ci5sZW5ndGg7aSsrKW9bci5jaGFyQ29kZUF0KGkpXT1pfXZhciB1PXIuY2hhckF0KDY0KTtpZih1KXt2YXIgYT10LmluZGV4T2YodSk7LTEhPT1hJiYobj1hKX1yZXR1cm4gZnVuY3Rpb24odCxuLHIpe2Zvcih2YXIgbz1bXSxpPTAsdT0wO3U8bjt1KyspaWYodSU0KXt2YXIgYT1yW3QuY2hhckNvZGVBdCh1LTEpXTw8dSU0KjIsYz1yW3QuY2hhckNvZGVBdCh1KV0+Pj42LXUlNCoyO29baT4+PjJdfD0oYXxjKTw8MjQtaSU0KjgsaSsrfXJldHVybiBlLmNyZWF0ZShvLGkpfSh0LG4sbyl9LF9tYXA6IkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89In0sby5lbmMuQmFzZTY0KX0pKSxLbj11KChmdW5jdGlvbih0LG4pe3ZhciByO3QuZXhwb3J0cz0ocj1KbixmdW5jdGlvbigpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBBcnJheUJ1ZmZlcil7dmFyIHQ9ci5saWIuV29yZEFycmF5LG49dC5pbml0Oyh0LmluaXQ9ZnVuY3Rpb24odCl7aWYodCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyJiYodD1uZXcgVWludDhBcnJheSh0KSksKHQgaW5zdGFuY2VvZiBJbnQ4QXJyYXl8fCJ1bmRlZmluZWQiIT10eXBlb2YgVWludDhDbGFtcGVkQXJyYXkmJnQgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheXx8dCBpbnN0YW5jZW9mIEludDE2QXJyYXl8fHQgaW5zdGFuY2VvZiBVaW50MTZBcnJheXx8dCBpbnN0YW5jZW9mIEludDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBVaW50MzJBcnJheXx8dCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheXx8dCBpbnN0YW5jZW9mIEZsb2F0NjRBcnJheSkmJih0PW5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCx0LmJ5dGVMZW5ndGgpKSx0IGluc3RhbmNlb2YgVWludDhBcnJheSl7Zm9yKHZhciByPXQuYnl0ZUxlbmd0aCxlPVtdLG89MDtvPHI7bysrKWVbbz4+PjJdfD10W29dPDwyNC1vJTQqODtuLmNhbGwodGhpcyxlLHIpfWVsc2Ugbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KS5wcm90b3R5cGU9dH19KCksci5saWIuV29yZEFycmF5KX0pKTtmdW5jdGlvbiBRbih0KXtyZXR1cm4gRG4odCk/S24uY3JlYXRlKHQpLnRvU3RyaW5nKFZuKToiIn1mdW5jdGlvbiBYbih0KXtpZighRHQodCkpcmV0dXJuIG5ldyBVaW50OEFycmF5O2Zvcih2YXIgbj1Wbi5wYXJzZSh0KSxyPW4ud29yZHMsZT1uLnNpZ0J5dGVzLG89bmV3IFVpbnQ4QXJyYXkoZSksaT0wO2k8ZTtpKyspe3ZhciB1PXJbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O29baV09dX1yZXR1cm4gb31mdW5jdGlvbiBZbih0KXtyZXR1cm4gSG4odCk/UW4oZnVuY3Rpb24odCl7cmV0dXJuIEhuKHQpP25ldyBVaW50OEFycmF5KHQpOm5ldyBVaW50OEFycmF5fSh0KSk6IiJ9ZnVuY3Rpb24gWm4odCl7cmV0dXJuIER0KHQpP2Z1bmN0aW9uKHQpe3JldHVybiBEbih0KT9uZXcgVWludDE2QXJyYXkodCk6bmV3IFVpbnQxNkFycmF5fShYbih0KSk6bmV3IFVpbnQxNkFycmF5fXZhciB0cj0iW1VpbnQ4QXJyYXldOjoiO3ZhciBucj0iW1VpbnQxNkFycmF5XTo6Ijt2YXIgcnI9e3RhZ1U4QTp0cix1OGFycjJiNjQ6ZnVuY3Rpb24odCl7cmV0dXJuIERuKHQpP3RyK1FuKHQpOnR9LGI2NDJ1OGFycjpmdW5jdGlvbih0KXtyZXR1cm4gRHQodCkmJkduKHQsdHIubGVuZ3RoKT09PXRyP1huKHQ9cW4odCx0ci5sZW5ndGgpKTp0fSx0YWdVMTZBOm5yLHUxNmFycjJiNjQ6ZnVuY3Rpb24odCl7cmV0dXJuIEhuKHQpP25yK1luKHQpOnR9LGI2NDJ1MTZhcnI6ZnVuY3Rpb24odCl7cmV0dXJuIER0KHQpJiZHbih0LG5yLmxlbmd0aCk9PT1ucj9abih0PXFuKHQsbnIubGVuZ3RoKSk6dH19O2Z1bmN0aW9uIGVyKHQpe3JldHVybiJbb2JqZWN0IFVuZGVmaW5lZF0iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpfWZ1bmN0aW9uIG9yKHQpe3JldHVybiJbb2JqZWN0IEFycmF5XSI9PT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCl9ZnVuY3Rpb24gaXIodCxuLHIsZSxvKXt2YXIgaT1mdW5jdGlvbih0KXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06IlVpbnQ4QXJyYXkiO2lmKGVyKHQpKXJldHVybiIiO2lmKER0KG4pKW49W25dO2Vsc2UgaWYoIW9yKG4pKXJldHVybiIiO2Z1bmN0aW9uIHIodCxyKXtyZXR1cm4gbi5pbmRleE9mKCJVaW50OEFycmF5Iik+PTAmJihyPXJyLnU4YXJyMmI2NChyKSksbi5pbmRleE9mKCJVaW50MTZBcnJheSIpPj0wJiYocj1yci51MTZhcnIyYjY0KHIpKSxyfXZhciBlPSIiO3RyeXtlPUpTT04uc3RyaW5naWZ5KHQscil9Y2F0Y2godCl7ZT0iIn1yZXR1cm4gZX0ociksdT12bihpLG4pLGE9dG4oKSxjPXUubGVuZ3RoO1JuKHUsKGZ1bmN0aW9uKG4scil7bj1obihuLCIiKTt2YXIgaT0iIi5jb25jYXQoYSwifCIpLmNvbmNhdChyLCJ8IikuY29uY2F0KGMsInwiKS5jb25jYXQobik7dC5zZW5kKGksKGZ1bmN0aW9uKHQpe3QmJkIobykmJm8odCl9KSksQihlKSYmZSgocisxKS9jKjEwMCl9KSl9dmFyIHVyPWZ1bmN0aW9uKHQsbixyKXt2YXIgZT10Lmxlbmd0aDtyZXR1cm4gcj12b2lkIDA9PT1yP2U6ciwhbiYmcj49ZT90OmVuKHQsbixyKX0sYXI9UmVnRXhwKCJbXFx1MjAwZFxcdWQ4MDAtXFx1ZGZmZlxcdTAzMDAtXFx1MDM2ZlxcdWZlMjAtXFx1ZmUyZlxcdTIwZDAtXFx1MjBmZlxcdWZlMGVcXHVmZTBmXSIpO3ZhciBjcj1mdW5jdGlvbih0KXtyZXR1cm4gYXIudGVzdCh0KX07dmFyIGZyPWZ1bmN0aW9uKHQpe3JldHVybiBqKHQpJiYiW29iamVjdCBSZWdFeHBdIj09bSh0KX0sc3I9Qm4mJkJuLmlzUmVnRXhwLGxyPXNyP1VuKHNyKTpmcjt2YXIgdnI9ZnVuY3Rpb24odCl7cmV0dXJuIHQuc3BsaXQoIiIpfSxwcj0iW1xcdWQ4MDAtXFx1ZGZmZl0iLGhyPSJbXFx1MDMwMC1cXHUwMzZmXFx1ZmUyMC1cXHVmZTJmXFx1MjBkMC1cXHUyMGZmXSIseXI9IlxcdWQ4M2NbXFx1ZGZmYi1cXHVkZmZmXSIsZHI9IlteXFx1ZDgwMC1cXHVkZmZmXSIsZ3I9Iig/OlxcdWQ4M2NbXFx1ZGRlNi1cXHVkZGZmXSl7Mn0iLGJyPSJbXFx1ZDgwMC1cXHVkYmZmXVtcXHVkYzAwLVxcdWRmZmZdIixfcj0iKD86IitocisifCIreXIrIikiKyI/Iixtcj0iW1xcdWZlMGVcXHVmZTBmXT8iK19yKygiKD86XFx1MjAwZCg/OiIrW2RyLGdyLGJyXS5qb2luKCJ8IikrIilbXFx1ZmUwZVxcdWZlMGZdPyIrX3IrIikqIiksanI9Iig/OiIrW2RyK2hyKyI/Iixocixncixicixwcl0uam9pbigifCIpKyIpIix3cj1SZWdFeHAoeXIrIig/PSIreXIrIil8IitqcittciwiZyIpO3ZhciBBcj1mdW5jdGlvbih0KXtyZXR1cm4gdC5tYXRjaCh3cil8fFtdfTt2YXIgT3I9ZnVuY3Rpb24odCl7cmV0dXJuIGNyKHQpP0FyKHQpOnZyKHQpfTt2YXIgeHI9ZnVuY3Rpb24odCxuLHIpe3JldHVybiByJiYibnVtYmVyIiE9dHlwZW9mIHImJmZuKHQsbixyKSYmKG49cj12b2lkIDApLChyPXZvaWQgMD09PXI/NDI5NDk2NzI5NTpyPj4+MCk/KHQ9QnQodCkpJiYoInN0cmluZyI9PXR5cGVvZiBufHxudWxsIT1uJiYhbHIobikpJiYhKG49VXQobikpJiZjcih0KT91cihPcih0KSwwLHIpOnQuc3BsaXQobixyKTpbXX07dmFyIFNyPWZ1bmN0aW9uKHQsbixyKXt2YXIgZT1udWxsPT10PzA6dC5sZW5ndGg7cmV0dXJuIGU/KG49cnx8dm9pZCAwPT09bj8xOiR0KG4pLGVuKHQsbjwwPzA6bixlKSk6W119LFVyPU1hdGguY2VpbCxCcj1NYXRoLm1heDt2YXIga3I9ZnVuY3Rpb24odCxuLHIsZSl7Zm9yKHZhciBvPS0xLGk9QnIoVXIoKG4tdCkvKHJ8fDEpKSwwKSx1PUFycmF5KGkpO2ktLTspdVtlP2k6KytvXT10LHQrPXI7cmV0dXJuIHV9O3ZhciBDcj1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24obixyLGUpe3JldHVybiBlJiYibnVtYmVyIiE9dHlwZW9mIGUmJmZuKG4scixlKSYmKHI9ZT12b2lkIDApLG49SXQobiksdm9pZCAwPT09cj8ocj1uLG49MCk6cj1JdChyKSxlPXZvaWQgMD09PWU/bjxyPzE6LTE6SXQoZSksa3IobixyLGUsdCl9fSgpO2Z1bmN0aW9uIHpyKHQsbil7cmV0dXJuIHI9dCwiW29iamVjdCBPYmplY3RdIj09PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChyKSYmKCEhSHQobikmJm4gaW4gdCk7dmFyIHJ9dmFyIFByPXt9O2Z1bmN0aW9uIEVyKHQsbil7dmFyIHI9eHIodCwifCIpLGU9clswXSxvPVd0KHJbMV0pLGk9V3QoclsyXSksdT1obihTcihyLDMpLCJ8Iik7aWYoenIoUHIsZSl8fChQcltlXT17fSksUHJbZV1bIl8iK29dPXUsbz09PWktMSl7dmFyIGE9IiI7Um4oQ3IoaSksKGZ1bmN0aW9uKHQpe2ErPVByW2VdWyJfIit0XX0pKSxkZWxldGUgUHJbZV0sbihmdW5jdGlvbih0KXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06IlVpbnQ4QXJyYXkiO2lmKER0KG4pKW49W25dO2Vsc2UgaWYoIW9yKG4pKXJldHVybnt9O2Z1bmN0aW9uIHIodCxyKXtyZXR1cm4gbi5pbmRleE9mKCJVaW50OEFycmF5Iik+PTAmJihyPXJyLmI2NDJ1OGFycihyKSksbi5pbmRleE9mKCJVaW50MTZBcnJheSIpPj0wJiYocj1yci5iNjQydTE2YXJyKHIpKSxyfXZhciBlPXt9O3RyeXtlPUpTT04ucGFyc2UodCxyKX1jYXRjaCh0KXtlPXt9fXJldHVybiBlfShhKSl9fXJldHVybiBmdW5jdGlvbih0KXt2YXIgbj0hMSxyPW51bGwsbz1uZXcgcm4saT1uZXcgcm47ZnVuY3Rpb24gdSh0KXtmb3IodmFyIG49YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheShuPjE/bi0xOjApLGU9MTtlPG47ZSsrKXJbZS0xXT1hcmd1bWVudHNbZV07c2V0VGltZW91dCgoZnVuY3Rpb24oKXtvLmVtaXQuYXBwbHkobyxbdF0uY29uY2F0KHIpKX0pLDEpfWZ1bmN0aW9uIGEoKXt0LnVybHx8KHQudXJsPSJ3czovL2xvY2FsaG9zdDo4MDgwIiksdC50b2tlbnx8KHQudG9rZW49IioiKSx0LnN0clNwbGl0TGVuZ3RofHwodC5zdHJTcGxpdExlbmd0aD0xZTYpO3ZhciBhPXt1cmw6dC51cmwsdG9rZW46dC50b2tlbixvcGVuOmZ1bmN0aW9uKCl7dSgib3BlbiIpLG58fCh1KCJvcGVuT25jZSIpLG49ITApfSxjbG9zZTpmdW5jdGlvbigpe3UoImNsb3NlIiksYygpfSxtZXNzYWdlOmZ1bmN0aW9uKHQpeyFmdW5jdGlvbih0KXtFcih0LHMpfSh0KX0sZXJyb3I6ZnVuY3Rpb24odCl7Zih0KX19O3RyeXtyPW5ldyBlKGEpfWNhdGNoKHQpe3JldHVybiB1KCJlcnJvciIse21zZzoiY2FuIG5vdCBjcmVhdGUgd2Vic29ja2V0IixlcnI6dH0pLHZvaWQgYygpfWlmKFB0KHIsImVycm9yIikpcmV0dXJuIHUoImVycm9yIix7bXNnOiJjYW4gbm90IGNyZWF0ZSB3ZWJzb2NrZXQiLGVycjoiY2FuIG5vdCBuZXcgTWl4V1MgaW4gV1dlYnNvY2tldENsaWVudCJ9KSx2b2lkIGMoKTtmdW5jdGlvbiBmKHQpe3UoImVycm9yIix7bXNnOiJ3ZWJzb2NrZXQgZXJyb3IiLGVycjp0fSksci5jbG9zZSgpfWZ1bmN0aW9uIHModCl7dmFyIG49UHQodCwiX21vZGUiLCIiKTtpZigiZXhlY3V0ZSI9PT1uKWlmKFB0KHQsIl9pZCIpJiZQdCh0LCJvdXRwdXQiKSl7dmFyIHI9UHQodCwiX2lkIiksZT1QdCh0LCJvdXRwdXQiKTtpLmVtaXQocixlKX1lbHNlIHUoImVycm9yIix7bXNnOiJjYW4gbm90IGZpbmQgX2lkIGFuZCBvdXRwdXQgaW4gZGF0YSIsZXJyOnR9KTtlbHNlImJyb2FkY2FzdCI9PT1uP3UoImJyb2FkY2FzdCIsUHQodCwiZGF0YSIpKToiZGVsaXZlciI9PT1uP3UoImRlbGl2ZXIiLFB0KHQsImRhdGEiKSk6Zih7bXNnOiJjYW4gbm90IGZpbmQgX21vZGUgaW4gZGF0YSIsZXJyOnR9KX1mdW5jdGlvbiBsKG4sZSl7ci5yZWFkeVN0YXRlPT09ci5PUEVOJiZpcihyLHQuc3RyU3BsaXRMZW5ndGgsbixlLChmdW5jdGlvbih0KXt1KCJlcnJvciIse21zZzoiY2FuIG5vdCBzZW5kIG1lc3NhZ2UiLGVycjp0fSl9KSl9by5yZW1vdmVBbGxMaXN0ZW5lcnMoInRyaWdnZXJFeGVjdXRlIiksby5vbigidHJpZ2dlckV4ZWN1dGUiLChmdW5jdGlvbih0KXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06bnVsbCxyPWFyZ3VtZW50cy5sZW5ndGg+Mj9hcmd1bWVudHNbMl06dm9pZCAwLGU9YXJndW1lbnRzLmxlbmd0aD4zP2FyZ3VtZW50c1szXTp2b2lkIDAsbz10bigpLHU9e19tb2RlOiJleGVjdXRlIixfaWQ6byxmdW5jOnQsaW5wdXQ6bn07bCh1LGUpLGkub24obywoZnVuY3Rpb24odCl7cih0KSxpLnJlbW92ZUFsbExpc3RlbmVycyhvKX0pKX0pKSxvLnJlbW92ZUFsbExpc3RlbmVycygidHJpZ2dlckJyb2FkY2FzdCIpLG8ub24oInRyaWdnZXJCcm9hZGNhc3QiLChmdW5jdGlvbih0LG4pe2woe19tb2RlOiJicm9hZGNhc3QiLGRhdGE6dH0sbil9KSksby5yZW1vdmVBbGxMaXN0ZW5lcnMoInRyaWdnZXJEZWxpdmVyIiksby5vbigidHJpZ2dlckRlbGl2ZXIiLChmdW5jdGlvbih0LG4pe2woe19tb2RlOiJkZWxpdmVyIixkYXRhOnR9LG4pfSkpfWZ1bmN0aW9uIGMoKXtzZXRUaW1lb3V0KChmdW5jdGlvbigpe3UoInJlY29ubiIpLGEoKX0pLDFlMyl9cmV0dXJuIG8uZXhlY3V0ZT1mdW5jdGlvbih0LG4pe3ZhciByPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTpmdW5jdGlvbigpe30sZT1FdCgpO3JldHVybiB1KCJ0cmlnZ2VyRXhlY3V0ZSIsdCxuLChmdW5jdGlvbih0KXtlLnJlc29sdmUodCl9KSxyKSxlfSxvLmJyb2FkY2FzdD1mdW5jdGlvbih0KXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06ZnVuY3Rpb24oKXt9O3UoInRyaWdnZXJCcm9hZGNhc3QiLHQsbil9LG8uZGVsaXZlcj1mdW5jdGlvbih0KXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06ZnVuY3Rpb24oKXt9O3UoInRyaWdnZXJEZWxpdmVyIix0LG4pfSxhKCksb319KCk7dmFyIHdvPW51bGwsYkluaXQ9ITE7ZnVuY3Rpb24gaW5pdChhKXtiSW5pdHx8KHdvPW5ldyBXQ29udmVyd3NDbGllbnQoYSksd28ub24oIm9wZW4iLGZ1bmN0aW9uKCl7c2VuZFN5c3RlbU1lc3NhZ2UoIm9wZW4iKX0pLHdvLm9uKCJvcGVuT25jZSIsZnVuY3Rpb24oKXtzZW5kU3lzdGVtTWVzc2FnZSgib3Blbk9uY2UiKSxiSW5pdD0hMH0pLHdvLm9uKCJjbG9zZSIsZnVuY3Rpb24oKXtzZW5kU3lzdGVtTWVzc2FnZSgiY2xvc2UiKX0pLHdvLm9uKCJlcnJvciIsZnVuY3Rpb24oYSl7c2VuZFN5c3RlbU1lc3NhZ2UoImVycm9yIixhKX0pLHdvLm9uKCJyZWNvbm4iLGZ1bmN0aW9uKCl7c2VuZFN5c3RlbU1lc3NhZ2UoInJlY29ubiIpfSksd28ub24oImJyb2FkY2FzdCIsZnVuY3Rpb24oYSl7c2VuZFN5c3RlbU1lc3NhZ2UoImJyb2FkY2FzdCIsYSl9KSx3by5vbigiZGVsaXZlciIsZnVuY3Rpb24oYSl7c2VuZFN5c3RlbU1lc3NhZ2UoImRlbGl2ZXIiLGEpfSkpfWZ1bmN0aW9uIHNlbmRNZXNzYWdlKGEpe3NlbGYucG9zdE1lc3NhZ2UoYSl9ZnVuY3Rpb24gc2VuZFN5c3RlbU1lc3NhZ2UoYSl7dmFyIGI9MTxhcmd1bWVudHMubGVuZ3RoJiZhcmd1bWVudHNbMV0hPT12b2lkIDA/YXJndW1lbnRzWzFdOm51bGw7c2VuZE1lc3NhZ2Uoe19pZDoic3lzdGVtIixmdW5jOmEsZGF0YTpifSl9c2VsZi5vbm1lc3NhZ2U9ZnVuY3Rpb24oYSl7dmFyIGI9YS5kYXRhLGM9Yi50eXBlO2lmKCJpbml0Ij09PWMpe3ZhciBkPWIuX2lkLGU9Yi5pbnB1dDtpbml0KGUpO3ZhciBrPXNldEludGVydmFsKGZ1bmN0aW9uKCl7aWYoYkluaXQpe3NlbmRNZXNzYWdlKHtfaWQ6ZCxvdXRwdXQ6bnVsbH0pLGNsZWFySW50ZXJ2YWwoayl9fSwxMCl9ZWxzZSBpZigiZXhlY3V0ZSI9PT1jKXt2YXIgZj1iLl9pZCxnPWIuZnVuYyxoPWIuaW5wdXQ7d28uZXhlY3V0ZShnLGgsZnVuY3Rpb24oYSl7c2VuZE1lc3NhZ2Uoe19pZDpmLHByb2c6YX0pfSkudGhlbihmdW5jdGlvbihhKXtzZW5kTWVzc2FnZSh7X2lkOmYsb3V0cHV0OmF9KX0pfWVsc2UgaWYoImJyb2FkY2FzdCI9PT1jfHwiZGVsaXZlciI9PT1jKXt2YXIgaT1iLl9pZCxqPWIuaW5wdXQ7d29bY10oaixmdW5jdGlvbihhKXtzZW5kTWVzc2FnZSh7X2lkOmkscHJvZzphfSl9KX1lbHNlIHNlbmRTeXN0ZW1NZXNzYWdlKCJlcnJvciIsInR5cGUgZXJyb3I6ICIuY29uY2F0KGMpKX07'

//code
//let code = b642u8arr(codeB64)
let code = b642str(codeB64)


function genWebWorker(code) {

    //URL
    let URL = window.URL || window.webkitURL

    //blob
    let blob
    try {
        //BlobBuilder for IE11, 依然有安全性問題
        let BlobBuilder = window.BlobBuilder ||
            window.WebKitBlobBuilder ||
            window.MozBlobBuilder ||
            window.MSBlobBuilder
        blob = new BlobBuilder()
        blob.append(code)
        blob = blob.getBlob()
        return new Worker(URL.createObjectURL(blob))
    }
    catch (e) {
        //console.log('can not use BlobBuilder', e)
    }

    try {
        //blob for Chrome 8+, Firefox 6+, Safari 6.0+, Opera 15+
        blob = new Blob([code])
        return new Worker(URL.createObjectURL(blob))
    }
    catch (e) {
        //console.log('can not use Blob', e)
    }

    try {
        //data:application/javascript for Opera 10.60 - 12
        return new Worker('data:application/javascript,' + encodeURIComponent(code))
    }
    catch (e) {
        //console.log('can not use application/javascript', e)
    }

    return null
}


/**
 * 於瀏覽器(Browser)通過Web Worker建立WebSocket使用者端物件
 *
 * @class
 * @param {Object} opt 輸入設定參數物件
 * @param {String} [opt.url='ws://localhost:8080'] 輸入WebSocket伺服器ws網址，預設為'ws://localhost:8080'
 * @param {String} [opt.token='*'] 輸入使用者認證用token，預設為'*'
 * @param {Integer} [opt.strSplitLength=1000000] 輸入傳輸封包長度整數，預設為1000000
 * @returns {Object} 回傳通訊物件，可監聽事件open、openOnce、close、error、reconn、broadcast、deliver，可使用函數execute、broadcast、deliver
 * @example
 *
 * <script src="dist/w-converws-client-webworker.umd.js"></script>
 *
 * let opt = {
 *     url: 'ws://localhost:8080',
 *     token: '*',
 * }
 *
 * //new
 * let WConverwsClient = window['w-converws-client-webworker']
 * let wo = new WConverwsClient(opt)
 *
 * wo.on('open', function() {
 *     console.log('client web: open')
 * })
 * wo.on('openOnce', function() {
 *     console.log('client web: openOnce')
 *
 *     //execute
 *     wo.execute('add', { p1: 1, p2: 2 },
 *         function (prog) {
 *             console.log('client web: execute prog=', prog)
 *         })
 *         .then(function(r) {
 *             console.log('client web: execute: add=', r)
 *         })
 *
 *     //broadcast
 *     wo.broadcast('client web broadcast hi', function (prog) {
 *         console.log('client web: broadcast prog=', prog)
 *     })
 *
 *     //deliver
 *     wo.deliver('client deliver hi', function (prog) {
 *         console.log('client web: deliver prog=', prog)
 *     })
 *
 * })
 * wo.on('close', function() {
 *     console.log('client web: close')
 * })
 * wo.on('error', function(err) {
 *     console.log('client web: error=', err)
 * })
 * wo.on('reconn', function() {
 *     console.log('client web: reconn')
 * })
 * wo.on('broadcast', function(data) {
 *     console.log('client web: broadcast=', data)
 * })
 * // wo.on('deliver', function(data) { //伺服器目前無法針對client直接deliver
 * //     console.log('client web: deliver=', data)
 * // })
 *
 */
function WConverwsClientWebworker(opt) {


    //ee
    let ee = new Evem()


    //wk
    // let blob = new Blob([code], { type: 'text/javascript' })
    // let url = URL.createObjectURL(blob)
    // let wk = new Worker(url)
    // let wk = new Worker('./wkapi/wscs_webworker.mjs')
    let wk = genWebWorker(code)


    //check, IE11安全性問題
    if (wk === null) {
        return null
    }


    function init(opt) {

        //_id
        let _id = genID()

        //msg
        let msg = {
            _id,
            type: 'init',
            input: opt,
        }

        //postMessage
        wk.postMessage(msg)

    }
    init(opt)


    function terminate() {
        wk.terminate()
        wk = undefined
    }


    function execute(func, input, callback) {

        //pm
        let pm = genPm()

        //_id
        let _id = genID()

        //msg
        let msg = {
            _id,
            type: 'execute',
            func,
            input,
        }

        //postMessage
        wk.postMessage(msg)

        //等待結果回傳
        ee.on(_id, function (data) {

            //prog
            if (data.prog) {

                if (isfun(callback)) {

                    //callback
                    callback(data.prog)

                }

            }
            //output
            else {

                //resolve
                pm.resolve(data.output)

                //removeAllListeners
                ee.removeAllListeners(_id)

            }

        })

        return pm
    }


    function core(type, input, callback) {

        //pm
        let pm = genPm()

        //_id
        let _id = genID()

        //msg
        let msg = {
            _id,
            type,
            input,
        }

        //postMessage
        wk.postMessage(msg)

        //等待結果回傳
        ee.on(_id, function (data) {

            //callback
            if (isfun(callback)) {
                callback(data.prog)
            }

            //finish
            if (data.prog === 100) {

                //resolve
                pm.resolve()

                //removeAllListeners
                ee.removeAllListeners(_id)

            }

        })

        return pm
    }


    function broadcast(input, callback) {
        return core('broadcast', input, callback)
    }


    function deliver(input, callback) {
        return core('deliver', input, callback)
    }


    wk.onmessage = function (e) {

        //data
        let data = e.data

        //_id
        let _id = data._id

        if (_id !== 'system') {

            //emit
            ee.emit(_id, data)

        }
        else {

            //emit
            ee.emit(data.func, data.data)

        }

    }


    //save
    ee.execute = execute
    ee.broadcast = broadcast
    ee.deliver = deliver
    ee.terminate = terminate


    return ee
}


export default WConverwsClientWebworker
