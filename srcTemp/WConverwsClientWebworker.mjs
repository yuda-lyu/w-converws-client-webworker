import genID from 'wsemi/src/genID.mjs'
import genPm from 'wsemi/src/genPm.mjs'
import Evem from 'wsemi/src/evem.mjs'
import isfun from 'wsemi/src/isfun.mjs'
//import b642u8arr from 'wsemi/src/b642u8arr.mjs'
import b642str from 'wsemi/src/b642str.mjs'


//codeB64, 此處需提供worker執行程式碼, 因有特殊符號編譯困難, 故需先轉base64再使用
let codeB64 = 'IWZ1bmN0aW9uKGUsbil7Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzJiYidW5kZWZpbmVkIiE9dHlwZW9mIG1vZHVsZT9uKCk6ImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUobik6bigpfSgwLGZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXt2YXIgbj10aGlzLmNvbnN0cnVjdG9yO3JldHVybiB0aGlzLnRoZW4oZnVuY3Rpb24odCl7cmV0dXJuIG4ucmVzb2x2ZShlKCkpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gdH0pfSxmdW5jdGlvbih0KXtyZXR1cm4gbi5yZXNvbHZlKGUoKSkudGhlbihmdW5jdGlvbigpe3JldHVybiBuLnJlamVjdCh0KX0pfSl9ZnVuY3Rpb24gbihlKXtyZXR1cm4hKCFlfHwidW5kZWZpbmVkIj09dHlwZW9mIGUubGVuZ3RoKX1mdW5jdGlvbiB0KCl7fWZ1bmN0aW9uIG8oZSl7aWYoISh0aGlzIGluc3RhbmNlb2YgbykpdGhyb3cgbmV3IFR5cGVFcnJvcigiUHJvbWlzZXMgbXVzdCBiZSBjb25zdHJ1Y3RlZCB2aWEgbmV3Iik7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUpdGhyb3cgbmV3IFR5cGVFcnJvcigibm90IGEgZnVuY3Rpb24iKTt0aGlzLl9zdGF0ZT0wLHRoaXMuX2hhbmRsZWQ9ITEsdGhpcy5fdmFsdWU9dW5kZWZpbmVkLHRoaXMuX2RlZmVycmVkcz1bXSxjKGUsdGhpcyl9ZnVuY3Rpb24gcihlLG4pe2Zvcig7Mz09PWUuX3N0YXRlOyllPWUuX3ZhbHVlOzAhPT1lLl9zdGF0ZT8oZS5faGFuZGxlZD0hMCxvLl9pbW1lZGlhdGVGbihmdW5jdGlvbigpe3ZhciB0PTE9PT1lLl9zdGF0ZT9uLm9uRnVsZmlsbGVkOm4ub25SZWplY3RlZDtpZihudWxsIT09dCl7dmFyIG87dHJ5e289dChlLl92YWx1ZSl9Y2F0Y2gocil7cmV0dXJuIHZvaWQgZihuLnByb21pc2Uscil9aShuLnByb21pc2Usbyl9ZWxzZSgxPT09ZS5fc3RhdGU/aTpmKShuLnByb21pc2UsZS5fdmFsdWUpfSkpOmUuX2RlZmVycmVkcy5wdXNoKG4pfWZ1bmN0aW9uIGkoZSxuKXt0cnl7aWYobj09PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiQSBwcm9taXNlIGNhbm5vdCBiZSByZXNvbHZlZCB3aXRoIGl0c2VsZi4iKTtpZihuJiYoIm9iamVjdCI9PXR5cGVvZiBufHwiZnVuY3Rpb24iPT10eXBlb2Ygbikpe3ZhciB0PW4udGhlbjtpZihuIGluc3RhbmNlb2YgbylyZXR1cm4gZS5fc3RhdGU9MyxlLl92YWx1ZT1uLHZvaWQgdShlKTtpZigiZnVuY3Rpb24iPT10eXBlb2YgdClyZXR1cm4gdm9pZCBjKGZ1bmN0aW9uKGUsbil7cmV0dXJuIGZ1bmN0aW9uKCl7ZS5hcHBseShuLGFyZ3VtZW50cyl9fSh0LG4pLGUpfWUuX3N0YXRlPTEsZS5fdmFsdWU9bix1KGUpfWNhdGNoKHIpe2YoZSxyKX19ZnVuY3Rpb24gZihlLG4pe2UuX3N0YXRlPTIsZS5fdmFsdWU9bix1KGUpfWZ1bmN0aW9uIHUoZSl7Mj09PWUuX3N0YXRlJiYwPT09ZS5fZGVmZXJyZWRzLmxlbmd0aCYmby5faW1tZWRpYXRlRm4oZnVuY3Rpb24oKXtlLl9oYW5kbGVkfHxvLl91bmhhbmRsZWRSZWplY3Rpb25GbihlLl92YWx1ZSl9KTtmb3IodmFyIG49MCx0PWUuX2RlZmVycmVkcy5sZW5ndGg7dD5uO24rKylyKGUsZS5fZGVmZXJyZWRzW25dKTtlLl9kZWZlcnJlZHM9bnVsbH1mdW5jdGlvbiBjKGUsbil7dmFyIHQ9ITE7dHJ5e2UoZnVuY3Rpb24oZSl7dHx8KHQ9ITAsaShuLGUpKX0sZnVuY3Rpb24oZSl7dHx8KHQ9ITAsZihuLGUpKX0pfWNhdGNoKG8pe2lmKHQpcmV0dXJuO3Q9ITAsZihuLG8pfX12YXIgYT1zZXRUaW1lb3V0O28ucHJvdG90eXBlWyJjYXRjaCJdPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnRoZW4obnVsbCxlKX0sby5wcm90b3R5cGUudGhlbj1mdW5jdGlvbihlLG4pe3ZhciBvPW5ldyB0aGlzLmNvbnN0cnVjdG9yKHQpO3JldHVybiByKHRoaXMsbmV3IGZ1bmN0aW9uKGUsbix0KXt0aGlzLm9uRnVsZmlsbGVkPSJmdW5jdGlvbiI9PXR5cGVvZiBlP2U6bnVsbCx0aGlzLm9uUmVqZWN0ZWQ9ImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpudWxsLHRoaXMucHJvbWlzZT10fShlLG4sbykpLG99LG8ucHJvdG90eXBlWyJmaW5hbGx5Il09ZSxvLmFsbD1mdW5jdGlvbihlKXtyZXR1cm4gbmV3IG8oZnVuY3Rpb24odCxvKXtmdW5jdGlvbiByKGUsbil7dHJ5e2lmKG4mJigib2JqZWN0Ij09dHlwZW9mIG58fCJmdW5jdGlvbiI9PXR5cGVvZiBuKSl7dmFyIHU9bi50aGVuO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiB1KXJldHVybiB2b2lkIHUuY2FsbChuLGZ1bmN0aW9uKG4pe3IoZSxuKX0sbyl9aVtlXT1uLDA9PS0tZiYmdChpKX1jYXRjaChjKXtvKGMpfX1pZighbihlKSlyZXR1cm4gbyhuZXcgVHlwZUVycm9yKCJQcm9taXNlLmFsbCBhY2NlcHRzIGFuIGFycmF5IikpO3ZhciBpPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGUpO2lmKDA9PT1pLmxlbmd0aClyZXR1cm4gdChbXSk7Zm9yKHZhciBmPWkubGVuZ3RoLHU9MDtpLmxlbmd0aD51O3UrKylyKHUsaVt1XSl9KX0sby5yZXNvbHZlPWZ1bmN0aW9uKGUpe3JldHVybiBlJiYib2JqZWN0Ij09dHlwZW9mIGUmJmUuY29uc3RydWN0b3I9PT1vP2U6bmV3IG8oZnVuY3Rpb24obil7bihlKX0pfSxvLnJlamVjdD1mdW5jdGlvbihlKXtyZXR1cm4gbmV3IG8oZnVuY3Rpb24obix0KXt0KGUpfSl9LG8ucmFjZT1mdW5jdGlvbihlKXtyZXR1cm4gbmV3IG8oZnVuY3Rpb24odCxyKXtpZighbihlKSlyZXR1cm4gcihuZXcgVHlwZUVycm9yKCJQcm9taXNlLnJhY2UgYWNjZXB0cyBhbiBhcnJheSIpKTtmb3IodmFyIGk9MCxmPWUubGVuZ3RoO2Y+aTtpKyspby5yZXNvbHZlKGVbaV0pLnRoZW4odCxyKX0pfSxvLl9pbW1lZGlhdGVGbj0iZnVuY3Rpb24iPT10eXBlb2Ygc2V0SW1tZWRpYXRlJiZmdW5jdGlvbihlKXtzZXRJbW1lZGlhdGUoZSl9fHxmdW5jdGlvbihlKXthKGUsMCl9LG8uX3VuaGFuZGxlZFJlamVjdGlvbkZuPWZ1bmN0aW9uKGUpe3ZvaWQgMCE9PWNvbnNvbGUmJmNvbnNvbGUmJmNvbnNvbGUud2FybigiUG9zc2libGUgVW5oYW5kbGVkIFByb21pc2UgUmVqZWN0aW9uOiIsZSl9O3ZhciBsPWZ1bmN0aW9uKCl7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmKXJldHVybiBzZWxmO2lmKCJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93KXJldHVybiB3aW5kb3c7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWwpcmV0dXJuIGdsb2JhbDt0aHJvdyBFcnJvcigidW5hYmxlIHRvIGxvY2F0ZSBnbG9iYWwgb2JqZWN0Iil9KCk7IlByb21pc2UiaW4gbD9sLlByb21pc2UucHJvdG90eXBlWyJmaW5hbGx5Il18fChsLlByb21pc2UucHJvdG90eXBlWyJmaW5hbGx5Il09ZSk6bC5Qcm9taXNlPW99KTt2YXIgV0NvbnZlcndzQ2xpZW50PWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIG4odCl7dmFyIG49T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpO3JldHVybiJbb2JqZWN0IEZ1bmN0aW9uXSI9PT1ufHwiW29iamVjdCBBc3luY0Z1bmN0aW9uXSI9PT1ufWZ1bmN0aW9uIHIocil7dmFyIGU9bnVsbDtyLnVybHx8KHIudXJsPSJ3czovL2xvY2FsaG9zdDo4MDgwIiksci50b2tlbnx8KHIudG9rZW49IioiKTt2YXIgbyxpPWZ1bmN0aW9uKCl7dmFyIHQ9InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJnZvaWQgMCE9PXdpbmRvdy5kb2N1bWVudCxuPSJ1bmRlZmluZWQiIT10eXBlb2YgV29ya2VyR2xvYmFsU2NvcGUmJnNlbGYgaW5zdGFuY2VvZiBXb3JrZXJHbG9iYWxTY29wZTtyZXR1cm57aXNCcm93c2VyOnQ9dHx8bixpc1dlYldvcmtlcjpuLGlzTm9kZToidW5kZWZpbmVkIiE9dHlwZW9mIHByb2Nlc3MmJm51bGwhPXByb2Nlc3MudmVyc2lvbnMmJm51bGwhPXByb2Nlc3MudmVyc2lvbnMubm9kZX19KCkuaXNCcm93c2VyO289aT8oInVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDpudWxsKS5XZWJTb2NrZXQ6dDt0cnl7ZT1uZXcgbyhyLnVybCsiLz90b2tlbj0iK3IudG9rZW4pfWNhdGNoKHQpe2U9bnVsbH1pZihudWxsPT09ZSlyZXR1cm57ZXJyb3I6ImNhbiBub3QgbmV3IE1peFdTIn07ZnVuY3Rpb24gdSgpe24oci5vcGVuKSYmci5vcGVuKCl9ZnVuY3Rpb24gYSgpe24oci5jbG9zZSkmJnIuY2xvc2UoKX1mdW5jdGlvbiBjKHQpe24oci5tZXNzYWdlKSYmci5tZXNzYWdlKHQpfWZ1bmN0aW9uIGYodCl7bihyLmVycm9yKSYmci5lcnJvcih0KSxlLmNsb3NlKCl9cmV0dXJuIGk/KGUub25vcGVuPXUsZS5vbm1lc3NhZ2U9ZnVuY3Rpb24odCl7Yyh0LmRhdGEpfSxlLm9uY2xvc2U9YSxlLm9uZXJyb3I9Zik6KGUub24oIm9wZW4iLHUpLGUub24oIm1lc3NhZ2UiLGMpLGUub24oImNsb3NlIixhKSxlLm9uKCJlcnJvciIsZikpLGV9dD10JiZ0Lmhhc093blByb3BlcnR5KCJkZWZhdWx0Iik/dC5kZWZhdWx0OnQ7dmFyIGU9QXJyYXkuaXNBcnJheTtmdW5jdGlvbiBvKHQpe3JldHVybihvPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yP2Z1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdH06ZnVuY3Rpb24odCl7cmV0dXJuIHQmJiJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJnQuY29uc3RydWN0b3I9PT1TeW1ib2wmJnQhPT1TeW1ib2wucHJvdG90eXBlPyJzeW1ib2wiOnR5cGVvZiB0fSkodCl9dmFyIGk9InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjp7fTtmdW5jdGlvbiB1KHQsbil7cmV0dXJuIHQobj17ZXhwb3J0czp7fX0sbi5leHBvcnRzKSxuLmV4cG9ydHN9dmFyIGE9Im9iamVjdCI9PW8oaSkmJmkmJmkuT2JqZWN0PT09T2JqZWN0JiZpLGM9Im9iamVjdCI9PSgidW5kZWZpbmVkIj09dHlwZW9mIHNlbGY/InVuZGVmaW5lZCI6byhzZWxmKSkmJnNlbGYmJnNlbGYuT2JqZWN0PT09T2JqZWN0JiZzZWxmLGY9YXx8Y3x8RnVuY3Rpb24oInJldHVybiB0aGlzIikoKSxzPWYuU3ltYm9sLGw9T2JqZWN0LnByb3RvdHlwZSx2PWwuaGFzT3duUHJvcGVydHkscD1sLnRvU3RyaW5nLGg9cz9zLnRvU3RyaW5nVGFnOnZvaWQgMDt2YXIgeT1mdW5jdGlvbih0KXt2YXIgbj12LmNhbGwodCxoKSxyPXRbaF07dHJ5e3RbaF09dm9pZCAwO3ZhciBlPSEwfWNhdGNoKHQpe312YXIgbz1wLmNhbGwodCk7cmV0dXJuIGUmJihuP3RbaF09cjpkZWxldGUgdFtoXSksb30sZD1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nO3ZhciBnPWZ1bmN0aW9uKHQpe3JldHVybiBkLmNhbGwodCl9LGI9IltvYmplY3QgTnVsbF0iLF89IltvYmplY3QgVW5kZWZpbmVkXSIsbT1zP3MudG9TdHJpbmdUYWc6dm9pZCAwO3ZhciB3PWZ1bmN0aW9uKHQpe3JldHVybiBudWxsPT10P3ZvaWQgMD09PXQ/XzpiOm0mJm0gaW4gT2JqZWN0KHQpP3kodCk6Zyh0KX07dmFyIGo9ZnVuY3Rpb24odCl7cmV0dXJuIG51bGwhPXQmJiJvYmplY3QiPT1vKHQpfSxBPSJbb2JqZWN0IFN5bWJvbF0iO3ZhciBPPWZ1bmN0aW9uKHQpe3JldHVybiJzeW1ib2wiPT1vKHQpfHxqKHQpJiZ3KHQpPT1BfSx4PS9cLnxcWyg/OlteW1xdXSp8KFsiJ10pKD86KD8hXDEpW15cXF18XFwuKSo/XDEpXF0vLFM9L15cdyokLzt2YXIgVT1mdW5jdGlvbih0LG4pe2lmKGUodCkpcmV0dXJuITE7dmFyIHI9byh0KTtyZXR1cm4hKCJudW1iZXIiIT1yJiYic3ltYm9sIiE9ciYmImJvb2xlYW4iIT1yJiZudWxsIT10JiYhTyh0KSl8fChTLnRlc3QodCl8fCF4LnRlc3QodCl8fG51bGwhPW4mJnQgaW4gT2JqZWN0KG4pKX07dmFyIEI9ZnVuY3Rpb24odCl7dmFyIG49byh0KTtyZXR1cm4gbnVsbCE9dCYmKCJvYmplY3QiPT1ufHwiZnVuY3Rpb24iPT1uKX0saz0iW29iamVjdCBBc3luY0Z1bmN0aW9uXSIsQz0iW29iamVjdCBGdW5jdGlvbl0iLHo9IltvYmplY3QgR2VuZXJhdG9yRnVuY3Rpb25dIixQPSJbb2JqZWN0IFByb3h5XSI7dmFyIEUsTT1mdW5jdGlvbih0KXtpZighQih0KSlyZXR1cm4hMTt2YXIgbj13KHQpO3JldHVybiBuPT1DfHxuPT16fHxuPT1rfHxuPT1QfSxMPWZbIl9fY29yZS1qc19zaGFyZWRfXyJdLEY9KEU9L1teLl0rJC8uZXhlYyhMJiZMLmtleXMmJkwua2V5cy5JRV9QUk9UT3x8IiIpKT8iU3ltYm9sKHNyYylfMS4iK0U6IiI7dmFyIFQ9ZnVuY3Rpb24odCl7cmV0dXJuISFGJiZGIGluIHR9LFc9RnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nO3ZhciBJPWZ1bmN0aW9uKHQpe2lmKG51bGwhPXQpe3RyeXtyZXR1cm4gVy5jYWxsKHQpfWNhdGNoKHQpe310cnl7cmV0dXJuIHQrIiJ9Y2F0Y2godCl7fX1yZXR1cm4iIn0sJD0vXlxbb2JqZWN0IC4rP0NvbnN0cnVjdG9yXF0kLyxOPUZ1bmN0aW9uLnByb3RvdHlwZSxSPU9iamVjdC5wcm90b3R5cGUsRD1OLnRvU3RyaW5nLEg9Ui5oYXNPd25Qcm9wZXJ0eSxHPVJlZ0V4cCgiXiIrRC5jYWxsKEgpLnJlcGxhY2UoL1tcXF4kLiorPygpW1xde318XS9nLCJcXCQmIikucmVwbGFjZSgvaGFzT3duUHJvcGVydHl8KGZ1bmN0aW9uKS4qPyg/PVxcXCgpfCBmb3IgLis/KD89XFxcXSkvZywiJDEuKj8iKSsiJCIpO3ZhciBxPWZ1bmN0aW9uKHQpe3JldHVybiEoIUIodCl8fFQodCkpJiYoTSh0KT9HOiQpLnRlc3QoSSh0KSl9O3ZhciBKPWZ1bmN0aW9uKHQsbil7cmV0dXJuIG51bGw9PXQ/dm9pZCAwOnRbbl19O3ZhciBWPWZ1bmN0aW9uKHQsbil7dmFyIHI9Sih0LG4pO3JldHVybiBxKHIpP3I6dm9pZCAwfSxLPVYoT2JqZWN0LCJjcmVhdGUiKTt2YXIgUT1mdW5jdGlvbigpe3RoaXMuX19kYXRhX189Sz9LKG51bGwpOnt9LHRoaXMuc2l6ZT0wfTt2YXIgWD1mdW5jdGlvbih0KXt2YXIgbj10aGlzLmhhcyh0KSYmZGVsZXRlIHRoaXMuX19kYXRhX19bdF07cmV0dXJuIHRoaXMuc2l6ZS09bj8xOjAsbn0sWT0iX19sb2Rhc2hfaGFzaF91bmRlZmluZWRfXyIsWj1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O3ZhciB0dD1mdW5jdGlvbih0KXt2YXIgbj10aGlzLl9fZGF0YV9fO2lmKEspe3ZhciByPW5bdF07cmV0dXJuIHI9PT1ZP3ZvaWQgMDpyfXJldHVybiBaLmNhbGwobix0KT9uW3RdOnZvaWQgMH0sbnQ9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTt2YXIgcnQ9ZnVuY3Rpb24odCl7dmFyIG49dGhpcy5fX2RhdGFfXztyZXR1cm4gSz92b2lkIDAhPT1uW3RdOm50LmNhbGwobix0KX0sZXQ9Il9fbG9kYXNoX2hhc2hfdW5kZWZpbmVkX18iO3ZhciBvdD1mdW5jdGlvbih0LG4pe3ZhciByPXRoaXMuX19kYXRhX187cmV0dXJuIHRoaXMuc2l6ZSs9dGhpcy5oYXModCk/MDoxLHJbdF09SyYmdm9pZCAwPT09bj9ldDpuLHRoaXN9O2Z1bmN0aW9uIGl0KHQpe3ZhciBuPS0xLHI9bnVsbD09dD8wOnQubGVuZ3RoO2Zvcih0aGlzLmNsZWFyKCk7KytuPHI7KXt2YXIgZT10W25dO3RoaXMuc2V0KGVbMF0sZVsxXSl9fWl0LnByb3RvdHlwZS5jbGVhcj1RLGl0LnByb3RvdHlwZS5kZWxldGU9WCxpdC5wcm90b3R5cGUuZ2V0PXR0LGl0LnByb3RvdHlwZS5oYXM9cnQsaXQucHJvdG90eXBlLnNldD1vdDt2YXIgdXQ9aXQ7dmFyIGF0PWZ1bmN0aW9uKCl7dGhpcy5fX2RhdGFfXz1bXSx0aGlzLnNpemU9MH07dmFyIGN0PWZ1bmN0aW9uKHQsbil7cmV0dXJuIHQ9PT1ufHx0IT10JiZuIT1ufTt2YXIgZnQ9ZnVuY3Rpb24odCxuKXtmb3IodmFyIHI9dC5sZW5ndGg7ci0tOylpZihjdCh0W3JdWzBdLG4pKXJldHVybiByO3JldHVybi0xfSxzdD1BcnJheS5wcm90b3R5cGUuc3BsaWNlO3ZhciBsdD1mdW5jdGlvbih0KXt2YXIgbj10aGlzLl9fZGF0YV9fLHI9ZnQobix0KTtyZXR1cm4hKHI8MCkmJihyPT1uLmxlbmd0aC0xP24ucG9wKCk6c3QuY2FsbChuLHIsMSksLS10aGlzLnNpemUsITApfTt2YXIgdnQ9ZnVuY3Rpb24odCl7dmFyIG49dGhpcy5fX2RhdGFfXyxyPWZ0KG4sdCk7cmV0dXJuIHI8MD92b2lkIDA6bltyXVsxXX07dmFyIHB0PWZ1bmN0aW9uKHQpe3JldHVybiBmdCh0aGlzLl9fZGF0YV9fLHQpPi0xfTt2YXIgaHQ9ZnVuY3Rpb24odCxuKXt2YXIgcj10aGlzLl9fZGF0YV9fLGU9ZnQocix0KTtyZXR1cm4gZTwwPygrK3RoaXMuc2l6ZSxyLnB1c2goW3Qsbl0pKTpyW2VdWzFdPW4sdGhpc307ZnVuY3Rpb24geXQodCl7dmFyIG49LTEscj1udWxsPT10PzA6dC5sZW5ndGg7Zm9yKHRoaXMuY2xlYXIoKTsrK248cjspe3ZhciBlPXRbbl07dGhpcy5zZXQoZVswXSxlWzFdKX19eXQucHJvdG90eXBlLmNsZWFyPWF0LHl0LnByb3RvdHlwZS5kZWxldGU9bHQseXQucHJvdG90eXBlLmdldD12dCx5dC5wcm90b3R5cGUuaGFzPXB0LHl0LnByb3RvdHlwZS5zZXQ9aHQ7dmFyIGR0PXl0LGd0PVYoZiwiTWFwIik7dmFyIGJ0PWZ1bmN0aW9uKCl7dGhpcy5zaXplPTAsdGhpcy5fX2RhdGFfXz17aGFzaDpuZXcgdXQsbWFwOm5ldyhndHx8ZHQpLHN0cmluZzpuZXcgdXR9fTt2YXIgX3Q9ZnVuY3Rpb24odCl7dmFyIG49byh0KTtyZXR1cm4ic3RyaW5nIj09bnx8Im51bWJlciI9PW58fCJzeW1ib2wiPT1ufHwiYm9vbGVhbiI9PW4/Il9fcHJvdG9fXyIhPT10Om51bGw9PT10fTt2YXIgbXQ9ZnVuY3Rpb24odCxuKXt2YXIgcj10Ll9fZGF0YV9fO3JldHVybiBfdChuKT9yWyJzdHJpbmciPT10eXBlb2Ygbj8ic3RyaW5nIjoiaGFzaCJdOnIubWFwfTt2YXIgd3Q9ZnVuY3Rpb24odCl7dmFyIG49bXQodGhpcyx0KS5kZWxldGUodCk7cmV0dXJuIHRoaXMuc2l6ZS09bj8xOjAsbn07dmFyIGp0PWZ1bmN0aW9uKHQpe3JldHVybiBtdCh0aGlzLHQpLmdldCh0KX07dmFyIEF0PWZ1bmN0aW9uKHQpe3JldHVybiBtdCh0aGlzLHQpLmhhcyh0KX07dmFyIE90PWZ1bmN0aW9uKHQsbil7dmFyIHI9bXQodGhpcyx0KSxlPXIuc2l6ZTtyZXR1cm4gci5zZXQodCxuKSx0aGlzLnNpemUrPXIuc2l6ZT09ZT8wOjEsdGhpc307ZnVuY3Rpb24geHQodCl7dmFyIG49LTEscj1udWxsPT10PzA6dC5sZW5ndGg7Zm9yKHRoaXMuY2xlYXIoKTsrK248cjspe3ZhciBlPXRbbl07dGhpcy5zZXQoZVswXSxlWzFdKX19eHQucHJvdG90eXBlLmNsZWFyPWJ0LHh0LnByb3RvdHlwZS5kZWxldGU9d3QseHQucHJvdG90eXBlLmdldD1qdCx4dC5wcm90b3R5cGUuaGFzPUF0LHh0LnByb3RvdHlwZS5zZXQ9T3Q7dmFyIFN0PXh0LFV0PSJFeHBlY3RlZCBhIGZ1bmN0aW9uIjtmdW5jdGlvbiBCdCh0LG4pe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiB0fHxudWxsIT1uJiYiZnVuY3Rpb24iIT10eXBlb2Ygbil0aHJvdyBuZXcgVHlwZUVycm9yKFV0KTt2YXIgcj1mdW5jdGlvbiByKCl7dmFyIGU9YXJndW1lbnRzLG89bj9uLmFwcGx5KHRoaXMsZSk6ZVswXSxpPXIuY2FjaGU7aWYoaS5oYXMobykpcmV0dXJuIGkuZ2V0KG8pO3ZhciB1PXQuYXBwbHkodGhpcyxlKTtyZXR1cm4gci5jYWNoZT1pLnNldChvLHUpfHxpLHV9O3JldHVybiByLmNhY2hlPW5ldyhCdC5DYWNoZXx8U3QpLHJ9QnQuQ2FjaGU9U3Q7dmFyIGt0PUJ0LEN0PTUwMDt2YXIgenQ9L1teLltcXV0rfFxbKD86KC0/XGQrKD86XC5cZCspPyl8KFsiJ10pKCg/Oig/IVwyKVteXFxdfFxcLikqPylcMilcXXwoPz0oPzpcLnxcW1xdKSg/OlwufFxbXF18JCkpL2csUHQ9L1xcKFxcKT8vZyxFdD1mdW5jdGlvbih0KXt2YXIgbj1rdCh0LChmdW5jdGlvbih0KXtyZXR1cm4gci5zaXplPT09Q3QmJnIuY2xlYXIoKSx0fSkpLHI9bi5jYWNoZTtyZXR1cm4gbn0oKGZ1bmN0aW9uKHQpe3ZhciBuPVtdO3JldHVybiA0Nj09PXQuY2hhckNvZGVBdCgwKSYmbi5wdXNoKCIiKSx0LnJlcGxhY2UoenQsKGZ1bmN0aW9uKHQscixlLG8pe24ucHVzaChlP28ucmVwbGFjZShQdCwiJDEiKTpyfHx0KX0pKSxufSkpO3ZhciBNdD1mdW5jdGlvbih0LG4pe2Zvcih2YXIgcj0tMSxlPW51bGw9PXQ/MDp0Lmxlbmd0aCxvPUFycmF5KGUpOysrcjxlOylvW3JdPW4odFtyXSxyLHQpO3JldHVybiBvfSxMdD0xLzAsRnQ9cz9zLnByb3RvdHlwZTp2b2lkIDAsVHQ9RnQ/RnQudG9TdHJpbmc6dm9pZCAwO3ZhciBXdD1mdW5jdGlvbiB0KG4pe2lmKCJzdHJpbmciPT10eXBlb2YgbilyZXR1cm4gbjtpZihlKG4pKXJldHVybiBNdChuLHQpKyIiO2lmKE8obikpcmV0dXJuIFR0P1R0LmNhbGwobik6IiI7dmFyIHI9bisiIjtyZXR1cm4iMCI9PXImJjEvbj09LUx0PyItMCI6cn07dmFyIEl0PWZ1bmN0aW9uKHQpe3JldHVybiBudWxsPT10PyIiOld0KHQpfTt2YXIgJHQ9ZnVuY3Rpb24odCxuKXtyZXR1cm4gZSh0KT90OlUodCxuKT9bdF06RXQoSXQodCkpfSxOdD0xLzA7dmFyIFJ0PWZ1bmN0aW9uKHQpe2lmKCJzdHJpbmciPT10eXBlb2YgdHx8Tyh0KSlyZXR1cm4gdDt2YXIgbj10KyIiO3JldHVybiIwIj09biYmMS90PT0tTnQ/Ii0wIjpufTt2YXIgRHQ9ZnVuY3Rpb24odCxuKXtmb3IodmFyIHI9MCxlPShuPSR0KG4sdCkpLmxlbmd0aDtudWxsIT10JiZyPGU7KXQ9dFtSdChuW3IrK10pXTtyZXR1cm4gciYmcj09ZT90OnZvaWQgMH07dmFyIEh0PWZ1bmN0aW9uKHQsbixyKXt2YXIgZT1udWxsPT10P3ZvaWQgMDpEdCh0LG4pO3JldHVybiB2b2lkIDA9PT1lP3I6ZX07ZnVuY3Rpb24gR3QoKXt2YXIgdCxuLHI9bmV3IFByb21pc2UoKGZ1bmN0aW9uKCl7dD1hcmd1bWVudHNbMF0sbj1hcmd1bWVudHNbMV19KSk7cmV0dXJuIHIucmVzb2x2ZT10LHIucmVqZWN0PW4scn12YXIgcXQ9TmFOLEp0PS9eXHMrfFxzKyQvZyxWdD0vXlstK10weFswLTlhLWZdKyQvaSxLdD0vXjBiWzAxXSskL2ksUXQ9L14wb1swLTddKyQvaSxYdD1wYXJzZUludDt2YXIgWXQ9ZnVuY3Rpb24odCl7aWYoIm51bWJlciI9PXR5cGVvZiB0KXJldHVybiB0O2lmKE8odCkpcmV0dXJuIHF0O2lmKEIodCkpe3ZhciBuPSJmdW5jdGlvbiI9PXR5cGVvZiB0LnZhbHVlT2Y/dC52YWx1ZU9mKCk6dDt0PUIobik/bisiIjpufWlmKCJzdHJpbmciIT10eXBlb2YgdClyZXR1cm4gMD09PXQ/dDordDt0PXQucmVwbGFjZShKdCwiIik7dmFyIHI9S3QudGVzdCh0KTtyZXR1cm4gcnx8UXQudGVzdCh0KT9YdCh0LnNsaWNlKDIpLHI/Mjo4KTpWdC50ZXN0KHQpP3F0Oit0fSxadD0xLzAsdG49MTc5NzY5MzEzNDg2MjMxNTdlMjkyO3ZhciBubj1mdW5jdGlvbih0KXtyZXR1cm4gdD8odD1ZdCh0KSk9PT1adHx8dD09PS1adD8odDwwPy0xOjEpKnRuOnQ9PXQ/dDowOjA9PT10P3Q6MH07dmFyIHJuPWZ1bmN0aW9uKHQpe3ZhciBuPW5uKHQpLHI9biUxO3JldHVybiBuPT1uP3I/bi1yOm46MH07dmFyIGVuPWZ1bmN0aW9uKHQpe3JldHVybiJudW1iZXIiPT10eXBlb2YgdCYmdD09cm4odCl9O2Z1bmN0aW9uIG9uKHQpe3JldHVybiJbb2JqZWN0IFN0cmluZ10iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpfWZ1bmN0aW9uIHVuKHQpe3JldHVybiEoIW9uKHQpfHwiIj09PXQpfWZ1bmN0aW9uIGFuKHQpe3ZhciBuPSExO3JldHVybiB1bih0KT9uPSFpc05hTihOdW1iZXIodCkpOmZ1bmN0aW9uKHQpe3JldHVybiJbb2JqZWN0IE51bWJlcl0iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpfSh0KSYmKG49ITApLG59ZnVuY3Rpb24gY24odCl7cmV0dXJuIGFuKHQpP25uKHQpOjB9dmFyIGZuPWYuaXNGaW5pdGUsc249TWF0aC5taW47dmFyIGxuPWZ1bmN0aW9uKHQpe3ZhciBuPU1hdGhbdF07cmV0dXJuIGZ1bmN0aW9uKHQscil7aWYodD1ZdCh0KSwocj1udWxsPT1yPzA6c24ocm4ociksMjkyKSkmJmZuKHQpKXt2YXIgZT0oSXQodCkrImUiKS5zcGxpdCgiZSIpLG89bihlWzBdKyJlIisoK2VbMV0rcikpO3JldHVybisoKGU9KEl0KG8pKyJlIikuc3BsaXQoImUiKSlbMF0rImUiKygrZVsxXS1yKSl9cmV0dXJuIG4odCl9fSgicm91bmQiKTtmdW5jdGlvbiB2bih0KXtyZXR1cm4hIWZ1bmN0aW9uKHQpe3JldHVybiEhYW4odCkmJih0PWNuKHQpLGVuKHQpKX0odCkmJmZ1bmN0aW9uKHQpe2lmKCFhbih0KSlyZXR1cm4gMDt0PWNuKHQpO3ZhciBuPWxuKHQpO3JldHVybiIwIj09PVN0cmluZyhuKT8wOm59KHQpPjB9ZnVuY3Rpb24gcG4oKXt2YXIgdCxuPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTozMixyPSIwMTIzNDU2Nzg5QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eiIuc3BsaXQoIiIpLGU9W10sbz1yLmxlbmd0aDtpZih2bihuKSlmb3IodD0wO3Q8bjt0KyspZVt0XT1yWzB8TWF0aC5yYW5kb20oKSpvXTtlbHNle2lmKCJyZmM0MTIyIiE9PW4pcmV0dXJuIiI7dmFyIGk7Zm9yKGVbOF09ZVsxM109ZVsxOF09ZVsyM109Ii0iLGVbMTRdPSI0Iix0PTA7dDwzNjt0KyspZVt0XXx8KGk9MHwxNipNYXRoLnJhbmRvbSgpLGVbdF09clsxOT09PXQ/MyZpfDg6aV0pfXJldHVybiBlLmpvaW4oIiIpfXZhciBobj11KChmdW5jdGlvbih0KXt2YXIgbj1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LHI9In4iO2Z1bmN0aW9uIGUoKXt9ZnVuY3Rpb24gbyh0LG4scil7dGhpcy5mbj10LHRoaXMuY29udGV4dD1uLHRoaXMub25jZT1yfHwhMX1mdW5jdGlvbiBpKHQsbixlLGksdSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUpdGhyb3cgbmV3IFR5cGVFcnJvcigiVGhlIGxpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbiIpO3ZhciBhPW5ldyBvKGUsaXx8dCx1KSxjPXI/cituOm47cmV0dXJuIHQuX2V2ZW50c1tjXT90Ll9ldmVudHNbY10uZm4/dC5fZXZlbnRzW2NdPVt0Ll9ldmVudHNbY10sYV06dC5fZXZlbnRzW2NdLnB1c2goYSk6KHQuX2V2ZW50c1tjXT1hLHQuX2V2ZW50c0NvdW50KyspLHR9ZnVuY3Rpb24gdSh0LG4pezA9PS0tdC5fZXZlbnRzQ291bnQ/dC5fZXZlbnRzPW5ldyBlOmRlbGV0ZSB0Ll9ldmVudHNbbl19ZnVuY3Rpb24gYSgpe3RoaXMuX2V2ZW50cz1uZXcgZSx0aGlzLl9ldmVudHNDb3VudD0wfU9iamVjdC5jcmVhdGUmJihlLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKG51bGwpLChuZXcgZSkuX19wcm90b19ffHwocj0hMSkpLGEucHJvdG90eXBlLmV2ZW50TmFtZXM9ZnVuY3Rpb24oKXt2YXIgdCxlLG89W107aWYoMD09PXRoaXMuX2V2ZW50c0NvdW50KXJldHVybiBvO2ZvcihlIGluIHQ9dGhpcy5fZXZlbnRzKW4uY2FsbCh0LGUpJiZvLnB1c2gocj9lLnNsaWNlKDEpOmUpO3JldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzP28uY29uY2F0KE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHModCkpOm99LGEucHJvdG90eXBlLmxpc3RlbmVycz1mdW5jdGlvbih0KXt2YXIgbj1yP3IrdDp0LGU9dGhpcy5fZXZlbnRzW25dO2lmKCFlKXJldHVybltdO2lmKGUuZm4pcmV0dXJuW2UuZm5dO2Zvcih2YXIgbz0wLGk9ZS5sZW5ndGgsdT1uZXcgQXJyYXkoaSk7bzxpO28rKyl1W29dPWVbb10uZm47cmV0dXJuIHV9LGEucHJvdG90eXBlLmxpc3RlbmVyQ291bnQ9ZnVuY3Rpb24odCl7dmFyIG49cj9yK3Q6dCxlPXRoaXMuX2V2ZW50c1tuXTtyZXR1cm4gZT9lLmZuPzE6ZS5sZW5ndGg6MH0sYS5wcm90b3R5cGUuZW1pdD1mdW5jdGlvbih0LG4sZSxvLGksdSl7dmFyIGE9cj9yK3Q6dDtpZighdGhpcy5fZXZlbnRzW2FdKXJldHVybiExO3ZhciBjLGYscz10aGlzLl9ldmVudHNbYV0sbD1hcmd1bWVudHMubGVuZ3RoO2lmKHMuZm4pe3N3aXRjaChzLm9uY2UmJnRoaXMucmVtb3ZlTGlzdGVuZXIodCxzLmZuLHZvaWQgMCwhMCksbCl7Y2FzZSAxOnJldHVybiBzLmZuLmNhbGwocy5jb250ZXh0KSwhMDtjYXNlIDI6cmV0dXJuIHMuZm4uY2FsbChzLmNvbnRleHQsbiksITA7Y2FzZSAzOnJldHVybiBzLmZuLmNhbGwocy5jb250ZXh0LG4sZSksITA7Y2FzZSA0OnJldHVybiBzLmZuLmNhbGwocy5jb250ZXh0LG4sZSxvKSwhMDtjYXNlIDU6cmV0dXJuIHMuZm4uY2FsbChzLmNvbnRleHQsbixlLG8saSksITA7Y2FzZSA2OnJldHVybiBzLmZuLmNhbGwocy5jb250ZXh0LG4sZSxvLGksdSksITB9Zm9yKGY9MSxjPW5ldyBBcnJheShsLTEpO2Y8bDtmKyspY1tmLTFdPWFyZ3VtZW50c1tmXTtzLmZuLmFwcGx5KHMuY29udGV4dCxjKX1lbHNle3ZhciB2LHA9cy5sZW5ndGg7Zm9yKGY9MDtmPHA7ZisrKXN3aXRjaChzW2ZdLm9uY2UmJnRoaXMucmVtb3ZlTGlzdGVuZXIodCxzW2ZdLmZuLHZvaWQgMCwhMCksbCl7Y2FzZSAxOnNbZl0uZm4uY2FsbChzW2ZdLmNvbnRleHQpO2JyZWFrO2Nhc2UgMjpzW2ZdLmZuLmNhbGwoc1tmXS5jb250ZXh0LG4pO2JyZWFrO2Nhc2UgMzpzW2ZdLmZuLmNhbGwoc1tmXS5jb250ZXh0LG4sZSk7YnJlYWs7Y2FzZSA0OnNbZl0uZm4uY2FsbChzW2ZdLmNvbnRleHQsbixlLG8pO2JyZWFrO2RlZmF1bHQ6aWYoIWMpZm9yKHY9MSxjPW5ldyBBcnJheShsLTEpO3Y8bDt2KyspY1t2LTFdPWFyZ3VtZW50c1t2XTtzW2ZdLmZuLmFwcGx5KHNbZl0uY29udGV4dCxjKX19cmV0dXJuITB9LGEucHJvdG90eXBlLm9uPWZ1bmN0aW9uKHQsbixyKXtyZXR1cm4gaSh0aGlzLHQsbixyLCExKX0sYS5wcm90b3R5cGUub25jZT1mdW5jdGlvbih0LG4scil7cmV0dXJuIGkodGhpcyx0LG4sciwhMCl9LGEucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyPWZ1bmN0aW9uKHQsbixlLG8pe3ZhciBpPXI/cit0OnQ7aWYoIXRoaXMuX2V2ZW50c1tpXSlyZXR1cm4gdGhpcztpZighbilyZXR1cm4gdSh0aGlzLGkpLHRoaXM7dmFyIGE9dGhpcy5fZXZlbnRzW2ldO2lmKGEuZm4pYS5mbiE9PW58fG8mJiFhLm9uY2V8fGUmJmEuY29udGV4dCE9PWV8fHUodGhpcyxpKTtlbHNle2Zvcih2YXIgYz0wLGY9W10scz1hLmxlbmd0aDtjPHM7YysrKShhW2NdLmZuIT09bnx8byYmIWFbY10ub25jZXx8ZSYmYVtjXS5jb250ZXh0IT09ZSkmJmYucHVzaChhW2NdKTtmLmxlbmd0aD90aGlzLl9ldmVudHNbaV09MT09PWYubGVuZ3RoP2ZbMF06Zjp1KHRoaXMsaSl9cmV0dXJuIHRoaXN9LGEucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycz1mdW5jdGlvbih0KXt2YXIgbjtyZXR1cm4gdD8obj1yP3IrdDp0LHRoaXMuX2V2ZW50c1tuXSYmdSh0aGlzLG4pKToodGhpcy5fZXZlbnRzPW5ldyBlLHRoaXMuX2V2ZW50c0NvdW50PTApLHRoaXN9LGEucHJvdG90eXBlLm9mZj1hLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lcixhLnByb3RvdHlwZS5hZGRMaXN0ZW5lcj1hLnByb3RvdHlwZS5vbixhLnByZWZpeGVkPXIsYS5FdmVudEVtaXR0ZXI9YSx0LmV4cG9ydHM9YX0pKTtmdW5jdGlvbiB5bigpe3JldHVybiBuZXcgaG59dmFyIGRuPWZ1bmN0aW9uKHQsbixyKXt2YXIgZT0tMSxvPXQubGVuZ3RoO248MCYmKG49LW4+bz8wOm8rbiksKHI9cj5vP286cik8MCYmKHIrPW8pLG89bj5yPzA6ci1uPj4+MCxuPj4+PTA7Zm9yKHZhciBpPUFycmF5KG8pOysrZTxvOylpW2VdPXRbZStuXTtyZXR1cm4gaX0sZ249OTAwNzE5OTI1NDc0MDk5MTt2YXIgYm49ZnVuY3Rpb24odCl7cmV0dXJuIm51bWJlciI9PXR5cGVvZiB0JiZ0Pi0xJiZ0JTE9PTAmJnQ8PWdufTt2YXIgX249ZnVuY3Rpb24odCl7cmV0dXJuIG51bGwhPXQmJmJuKHQubGVuZ3RoKSYmIU0odCl9LG1uPTkwMDcxOTkyNTQ3NDA5OTEsd249L14oPzowfFsxLTldXGQqKSQvO3ZhciBqbj1mdW5jdGlvbih0LG4pe3ZhciByPW8odCk7cmV0dXJuISEobj1udWxsPT1uP21uOm4pJiYoIm51bWJlciI9PXJ8fCJzeW1ib2wiIT1yJiZ3bi50ZXN0KHQpKSYmdD4tMSYmdCUxPT0wJiZ0PG59O3ZhciBBbj1mdW5jdGlvbih0LG4scil7aWYoIUIocikpcmV0dXJuITE7dmFyIGU9byhuKTtyZXR1cm4hISgibnVtYmVyIj09ZT9fbihyKSYmam4obixyLmxlbmd0aCk6InN0cmluZyI9PWUmJm4gaW4gcikmJmN0KHJbbl0sdCl9LE9uPU1hdGguY2VpbCx4bj1NYXRoLm1heDt2YXIgU249ZnVuY3Rpb24odCxuLHIpe249KHI/QW4odCxuLHIpOnZvaWQgMD09PW4pPzE6eG4ocm4obiksMCk7dmFyIGU9bnVsbD09dD8wOnQubGVuZ3RoO2lmKCFlfHxuPDEpcmV0dXJuW107Zm9yKHZhciBvPTAsaT0wLHU9QXJyYXkoT24oZS9uKSk7bzxlOyl1W2krK109ZG4odCxvLG8rPW4pO3JldHVybiB1fSxVbj1BcnJheS5wcm90b3R5cGUuam9pbjt2YXIgQm49ZnVuY3Rpb24odCxuKXtyZXR1cm4gbnVsbD09dD8iIjpVbi5jYWxsKHQsbil9O3ZhciBrbj1mdW5jdGlvbih0LG4pe2Zvcih2YXIgcj0tMSxlPW51bGw9PXQ/MDp0Lmxlbmd0aDsrK3I8ZSYmITEhPT1uKHRbcl0scix0KTspO3JldHVybiB0fTt2YXIgQ249ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKG4scixlKXtmb3IodmFyIG89LTEsaT1PYmplY3QobiksdT1lKG4pLGE9dS5sZW5ndGg7YS0tOyl7dmFyIGM9dVt0P2E6KytvXTtpZighMT09PXIoaVtjXSxjLGkpKWJyZWFrfXJldHVybiBufX0oKTt2YXIgem49ZnVuY3Rpb24odCxuKXtmb3IodmFyIHI9LTEsZT1BcnJheSh0KTsrK3I8dDspZVtyXT1uKHIpO3JldHVybiBlfSxQbj0iW29iamVjdCBBcmd1bWVudHNdIjt2YXIgRW49ZnVuY3Rpb24odCl7cmV0dXJuIGoodCkmJncodCk9PVBufSxNbj1PYmplY3QucHJvdG90eXBlLExuPU1uLmhhc093blByb3BlcnR5LEZuPU1uLnByb3BlcnR5SXNFbnVtZXJhYmxlLFRuPUVuKGZ1bmN0aW9uKCl7cmV0dXJuIGFyZ3VtZW50c30oKSk/RW46ZnVuY3Rpb24odCl7cmV0dXJuIGoodCkmJkxuLmNhbGwodCwiY2FsbGVlIikmJiFGbi5jYWxsKHQsImNhbGxlZSIpfTt2YXIgV249ZnVuY3Rpb24oKXtyZXR1cm4hMX0sSW49dSgoZnVuY3Rpb24odCxuKXt2YXIgcj1uJiYhbi5ub2RlVHlwZSYmbixlPXImJnQmJiF0Lm5vZGVUeXBlJiZ0LG89ZSYmZS5leHBvcnRzPT09cj9mLkJ1ZmZlcjp2b2lkIDAsaT0obz9vLmlzQnVmZmVyOnZvaWQgMCl8fFduO3QuZXhwb3J0cz1pfSkpLCRuPXt9OyRuWyJbb2JqZWN0IEZsb2F0MzJBcnJheV0iXT0kblsiW29iamVjdCBGbG9hdDY0QXJyYXldIl09JG5bIltvYmplY3QgSW50OEFycmF5XSJdPSRuWyJbb2JqZWN0IEludDE2QXJyYXldIl09JG5bIltvYmplY3QgSW50MzJBcnJheV0iXT0kblsiW29iamVjdCBVaW50OEFycmF5XSJdPSRuWyJbb2JqZWN0IFVpbnQ4Q2xhbXBlZEFycmF5XSJdPSRuWyJbb2JqZWN0IFVpbnQxNkFycmF5XSJdPSRuWyJbb2JqZWN0IFVpbnQzMkFycmF5XSJdPSEwLCRuWyJbb2JqZWN0IEFyZ3VtZW50c10iXT0kblsiW29iamVjdCBBcnJheV0iXT0kblsiW29iamVjdCBBcnJheUJ1ZmZlcl0iXT0kblsiW29iamVjdCBCb29sZWFuXSJdPSRuWyJbb2JqZWN0IERhdGFWaWV3XSJdPSRuWyJbb2JqZWN0IERhdGVdIl09JG5bIltvYmplY3QgRXJyb3JdIl09JG5bIltvYmplY3QgRnVuY3Rpb25dIl09JG5bIltvYmplY3QgTWFwXSJdPSRuWyJbb2JqZWN0IE51bWJlcl0iXT0kblsiW29iamVjdCBPYmplY3RdIl09JG5bIltvYmplY3QgUmVnRXhwXSJdPSRuWyJbb2JqZWN0IFNldF0iXT0kblsiW29iamVjdCBTdHJpbmddIl09JG5bIltvYmplY3QgV2Vha01hcF0iXT0hMTt2YXIgTm49ZnVuY3Rpb24odCl7cmV0dXJuIGoodCkmJmJuKHQubGVuZ3RoKSYmISEkblt3KHQpXX07dmFyIFJuPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gdChuKX19LERuPXUoKGZ1bmN0aW9uKHQsbil7dmFyIHI9biYmIW4ubm9kZVR5cGUmJm4sZT1yJiZ0JiYhdC5ub2RlVHlwZSYmdCxvPWUmJmUuZXhwb3J0cz09PXImJmEucHJvY2VzcyxpPWZ1bmN0aW9uKCl7dHJ5e3ZhciB0PWUmJmUucmVxdWlyZSYmZS5yZXF1aXJlKCJ1dGlsIikudHlwZXM7cmV0dXJuIHR8fG8mJm8uYmluZGluZyYmby5iaW5kaW5nKCJ1dGlsIil9Y2F0Y2godCl7fX0oKTt0LmV4cG9ydHM9aX0pKSxIbj1EbiYmRG4uaXNUeXBlZEFycmF5LEduPUhuP1JuKEhuKTpObixxbj1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O3ZhciBKbj1mdW5jdGlvbih0LG4pe3ZhciByPWUodCksbz0hciYmVG4odCksaT0hciYmIW8mJkluKHQpLHU9IXImJiFvJiYhaSYmR24odCksYT1yfHxvfHxpfHx1LGM9YT96bih0Lmxlbmd0aCxTdHJpbmcpOltdLGY9Yy5sZW5ndGg7Zm9yKHZhciBzIGluIHQpIW4mJiFxbi5jYWxsKHQscyl8fGEmJigibGVuZ3RoIj09c3x8aSYmKCJvZmZzZXQiPT1zfHwicGFyZW50Ij09cyl8fHUmJigiYnVmZmVyIj09c3x8ImJ5dGVMZW5ndGgiPT1zfHwiYnl0ZU9mZnNldCI9PXMpfHxqbihzLGYpKXx8Yy5wdXNoKHMpO3JldHVybiBjfSxWbj1PYmplY3QucHJvdG90eXBlO3ZhciBLbj1mdW5jdGlvbih0KXt2YXIgbj10JiZ0LmNvbnN0cnVjdG9yO3JldHVybiB0PT09KCJmdW5jdGlvbiI9PXR5cGVvZiBuJiZuLnByb3RvdHlwZXx8Vm4pfTt2YXIgUW49ZnVuY3Rpb24odCxuKXtyZXR1cm4gZnVuY3Rpb24ocil7cmV0dXJuIHQobihyKSl9fShPYmplY3Qua2V5cyxPYmplY3QpLFhuPU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7dmFyIFluPWZ1bmN0aW9uKHQpe2lmKCFLbih0KSlyZXR1cm4gUW4odCk7dmFyIG49W107Zm9yKHZhciByIGluIE9iamVjdCh0KSlYbi5jYWxsKHQscikmJiJjb25zdHJ1Y3RvciIhPXImJm4ucHVzaChyKTtyZXR1cm4gbn07dmFyIFpuPWZ1bmN0aW9uKHQpe3JldHVybiBfbih0KT9Kbih0KTpZbih0KX07dmFyIHRyPWZ1bmN0aW9uKHQsbil7cmV0dXJuIGZ1bmN0aW9uKHIsZSl7aWYobnVsbD09cilyZXR1cm4gcjtpZighX24ocikpcmV0dXJuIHQocixlKTtmb3IodmFyIG89ci5sZW5ndGgsaT1uP286LTEsdT1PYmplY3Qocik7KG4/aS0tOisraTxvKSYmITEhPT1lKHVbaV0saSx1KTspO3JldHVybiByfX0oKGZ1bmN0aW9uKHQsbil7cmV0dXJuIHQmJkNuKHQsbixabil9KSk7dmFyIG5yPWZ1bmN0aW9uKHQpe3JldHVybiB0fTt2YXIgcnI9ZnVuY3Rpb24odCl7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIHQ/dDpucn07dmFyIGVyPWZ1bmN0aW9uKHQsbil7cmV0dXJuKGUodCk/a246dHIpKHQscnIobikpfTtmdW5jdGlvbiBvcih0KXtyZXR1cm4iW29iamVjdCBVaW50OEFycmF5XSI9PT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCl9ZnVuY3Rpb24gaXIodCl7cmV0dXJuIltvYmplY3QgVWludDE2QXJyYXldIj09PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0KX1mdW5jdGlvbiB1cih0LG4pe3JldHVybiB1bih0KSYmdm4obik/dC5zdWJzdHIoMCxuKToiIn1mdW5jdGlvbiBhcih0LG4pe3JldHVybiB1bih0KSYmdm4obik/ZnVuY3Rpb24odCxuKXtpZighdW4odCkpcmV0dXJuIiI7aWYoIXZuKG4pKXJldHVybiIiO3ZhciByPXQubGVuZ3RoLW47cmV0dXJuIHI8MCYmKHI9MCksdC5zdWJzdHIocixuKX0odCx0Lmxlbmd0aC1uKToiIn12YXIgY3I9dSgoZnVuY3Rpb24odCxuKXt2YXIgcjt0LmV4cG9ydHM9KHI9cnx8ZnVuY3Rpb24odCxuKXt2YXIgcj1PYmplY3QuY3JlYXRlfHxmdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt9cmV0dXJuIGZ1bmN0aW9uKG4pe3ZhciByO3JldHVybiB0LnByb3RvdHlwZT1uLHI9bmV3IHQsdC5wcm90b3R5cGU9bnVsbCxyfX0oKSxlPXt9LG89ZS5saWI9e30saT1vLkJhc2U9e2V4dGVuZDpmdW5jdGlvbih0KXt2YXIgbj1yKHRoaXMpO3JldHVybiB0JiZuLm1peEluKHQpLG4uaGFzT3duUHJvcGVydHkoImluaXQiKSYmdGhpcy5pbml0IT09bi5pbml0fHwobi5pbml0PWZ1bmN0aW9uKCl7bi4kc3VwZXIuaW5pdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KSxuLmluaXQucHJvdG90eXBlPW4sbi4kc3VwZXI9dGhpcyxufSxjcmVhdGU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmV4dGVuZCgpO3JldHVybiB0LmluaXQuYXBwbHkodCxhcmd1bWVudHMpLHR9LGluaXQ6ZnVuY3Rpb24oKXt9LG1peEluOmZ1bmN0aW9uKHQpe2Zvcih2YXIgbiBpbiB0KXQuaGFzT3duUHJvcGVydHkobikmJih0aGlzW25dPXRbbl0pO3QuaGFzT3duUHJvcGVydHkoInRvU3RyaW5nIikmJih0aGlzLnRvU3RyaW5nPXQudG9TdHJpbmcpfSxjbG9uZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmluaXQucHJvdG90eXBlLmV4dGVuZCh0aGlzKX19LHU9by5Xb3JkQXJyYXk9aS5leHRlbmQoe2luaXQ6ZnVuY3Rpb24odCxuKXt0PXRoaXMud29yZHM9dHx8W10sdGhpcy5zaWdCeXRlcz1udWxsIT1uP246NCp0Lmxlbmd0aH0sdG9TdHJpbmc6ZnVuY3Rpb24odCl7cmV0dXJuKHR8fGMpLnN0cmluZ2lmeSh0aGlzKX0sY29uY2F0OmZ1bmN0aW9uKHQpe3ZhciBuPXRoaXMud29yZHMscj10LndvcmRzLGU9dGhpcy5zaWdCeXRlcyxvPXQuc2lnQnl0ZXM7aWYodGhpcy5jbGFtcCgpLGUlNClmb3IodmFyIGk9MDtpPG87aSsrKXt2YXIgdT1yW2k+Pj4yXT4+PjI0LWklNCo4JjI1NTtuW2UraT4+PjJdfD11PDwyNC0oZStpKSU0Kjh9ZWxzZSBmb3IoaT0wO2k8bztpKz00KW5bZStpPj4+Ml09cltpPj4+Ml07cmV0dXJuIHRoaXMuc2lnQnl0ZXMrPW8sdGhpc30sY2xhbXA6ZnVuY3Rpb24oKXt2YXIgbj10aGlzLndvcmRzLHI9dGhpcy5zaWdCeXRlcztuW3I+Pj4yXSY9NDI5NDk2NzI5NTw8MzItciU0Kjgsbi5sZW5ndGg9dC5jZWlsKHIvNCl9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9aS5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0LndvcmRzPXRoaXMud29yZHMuc2xpY2UoMCksdH0scmFuZG9tOmZ1bmN0aW9uKG4pe2Zvcih2YXIgcixlPVtdLG89ZnVuY3Rpb24obil7bj1uO3ZhciByPTk4NzY1NDMyMSxlPTQyOTQ5NjcyOTU7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIG89KChyPTM2OTY5Kig2NTUzNSZyKSsocj4+MTYpJmUpPDwxNikrKG49MThlMyooNjU1MzUmbikrKG4+PjE2KSZlKSZlO3JldHVybiBvLz00Mjk0OTY3Mjk2LChvKz0uNSkqKHQucmFuZG9tKCk+LjU/MTotMSl9fSxpPTA7aTxuO2krPTQpe3ZhciBhPW8oNDI5NDk2NzI5Nioocnx8dC5yYW5kb20oKSkpO3I9OTg3NjU0MDcxKmEoKSxlLnB1c2goNDI5NDk2NzI5NiphKCl8MCl9cmV0dXJuIG5ldyB1LmluaXQoZSxuKX19KSxhPWUuZW5jPXt9LGM9YS5IZXg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIG49dC53b3JkcyxyPXQuc2lnQnl0ZXMsZT1bXSxvPTA7bzxyO28rKyl7dmFyIGk9bltvPj4+Ml0+Pj4yNC1vJTQqOCYyNTU7ZS5wdXNoKChpPj4+NCkudG9TdHJpbmcoMTYpKSxlLnB1c2goKDE1JmkpLnRvU3RyaW5nKDE2KSl9cmV0dXJuIGUuam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe2Zvcih2YXIgbj10Lmxlbmd0aCxyPVtdLGU9MDtlPG47ZSs9MilyW2U+Pj4zXXw9cGFyc2VJbnQodC5zdWJzdHIoZSwyKSwxNik8PDI0LWUlOCo0O3JldHVybiBuZXcgdS5pbml0KHIsbi8yKX19LGY9YS5MYXRpbjE9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIG49dC53b3JkcyxyPXQuc2lnQnl0ZXMsZT1bXSxvPTA7bzxyO28rKyl7dmFyIGk9bltvPj4+Ml0+Pj4yNC1vJTQqOCYyNTU7ZS5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoaSkpfXJldHVybiBlLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXtmb3IodmFyIG49dC5sZW5ndGgscj1bXSxlPTA7ZTxuO2UrKylyW2U+Pj4yXXw9KDI1NSZ0LmNoYXJDb2RlQXQoZSkpPDwyNC1lJTQqODtyZXR1cm4gbmV3IHUuaW5pdChyLG4pfX0scz1hLlV0Zjg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt0cnl7cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoZi5zdHJpbmdpZnkodCkpKX1jYXRjaCh0KXt0aHJvdyBuZXcgRXJyb3IoIk1hbGZvcm1lZCBVVEYtOCBkYXRhIil9fSxwYXJzZTpmdW5jdGlvbih0KXtyZXR1cm4gZi5wYXJzZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQodCkpKX19LGw9by5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtPWkuZXh0ZW5kKHtyZXNldDpmdW5jdGlvbigpe3RoaXMuX2RhdGE9bmV3IHUuaW5pdCx0aGlzLl9uRGF0YUJ5dGVzPTB9LF9hcHBlbmQ6ZnVuY3Rpb24odCl7InN0cmluZyI9PXR5cGVvZiB0JiYodD1zLnBhcnNlKHQpKSx0aGlzLl9kYXRhLmNvbmNhdCh0KSx0aGlzLl9uRGF0YUJ5dGVzKz10LnNpZ0J5dGVzfSxfcHJvY2VzczpmdW5jdGlvbihuKXt2YXIgcj10aGlzLl9kYXRhLGU9ci53b3JkcyxvPXIuc2lnQnl0ZXMsaT10aGlzLmJsb2NrU2l6ZSxhPW8vKDQqaSksYz0oYT1uP3QuY2VpbChhKTp0Lm1heCgoMHxhKS10aGlzLl9taW5CdWZmZXJTaXplLDApKSppLGY9dC5taW4oNCpjLG8pO2lmKGMpe2Zvcih2YXIgcz0wO3M8YztzKz1pKXRoaXMuX2RvUHJvY2Vzc0Jsb2NrKGUscyk7dmFyIGw9ZS5zcGxpY2UoMCxjKTtyLnNpZ0J5dGVzLT1mfXJldHVybiBuZXcgdS5pbml0KGwsZil9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9aS5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0Ll9kYXRhPXRoaXMuX2RhdGEuY2xvbmUoKSx0fSxfbWluQnVmZmVyU2l6ZTowfSksdj0oby5IYXNoZXI9bC5leHRlbmQoe2NmZzppLmV4dGVuZCgpLGluaXQ6ZnVuY3Rpb24odCl7dGhpcy5jZmc9dGhpcy5jZmcuZXh0ZW5kKHQpLHRoaXMucmVzZXQoKX0scmVzZXQ6ZnVuY3Rpb24oKXtsLnJlc2V0LmNhbGwodGhpcyksdGhpcy5fZG9SZXNldCgpfSx1cGRhdGU6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2FwcGVuZCh0KSx0aGlzLl9wcm9jZXNzKCksdGhpc30sZmluYWxpemU6ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnRoaXMuX2FwcGVuZCh0KSx0aGlzLl9kb0ZpbmFsaXplKCl9LGJsb2NrU2l6ZToxNixfY3JlYXRlSGVscGVyOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihuLHIpe3JldHVybiBuZXcgdC5pbml0KHIpLmZpbmFsaXplKG4pfX0sX2NyZWF0ZUhtYWNIZWxwZXI6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKG4scil7cmV0dXJuIG5ldyB2LkhNQUMuaW5pdCh0LHIpLmZpbmFsaXplKG4pfX19KSxlLmFsZ289e30pO3JldHVybiBlfShNYXRoKSxyKX0pKSxmcj11KChmdW5jdGlvbih0LG4pe3ZhciByLGUsbzt0LmV4cG9ydHM9KGU9KHI9bz1jcikubGliLldvcmRBcnJheSxyLmVuYy5CYXNlNjQ9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt2YXIgbj10LndvcmRzLHI9dC5zaWdCeXRlcyxlPXRoaXMuX21hcDt0LmNsYW1wKCk7Zm9yKHZhciBvPVtdLGk9MDtpPHI7aSs9Mylmb3IodmFyIHU9KG5baT4+PjJdPj4+MjQtaSU0KjgmMjU1KTw8MTZ8KG5baSsxPj4+Ml0+Pj4yNC0oaSsxKSU0KjgmMjU1KTw8OHxuW2krMj4+PjJdPj4+MjQtKGkrMiklNCo4JjI1NSxhPTA7YTw0JiZpKy43NSphPHI7YSsrKW8ucHVzaChlLmNoYXJBdCh1Pj4+NiooMy1hKSY2MykpO3ZhciBjPWUuY2hhckF0KDY0KTtpZihjKWZvcig7by5sZW5ndGglNDspby5wdXNoKGMpO3JldHVybiBvLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXt2YXIgbj10Lmxlbmd0aCxyPXRoaXMuX21hcCxvPXRoaXMuX3JldmVyc2VNYXA7aWYoIW8pe289dGhpcy5fcmV2ZXJzZU1hcD1bXTtmb3IodmFyIGk9MDtpPHIubGVuZ3RoO2krKylvW3IuY2hhckNvZGVBdChpKV09aX12YXIgdT1yLmNoYXJBdCg2NCk7aWYodSl7dmFyIGE9dC5pbmRleE9mKHUpOy0xIT09YSYmKG49YSl9cmV0dXJuIGZ1bmN0aW9uKHQsbixyKXtmb3IodmFyIG89W10saT0wLHU9MDt1PG47dSsrKWlmKHUlNCl7dmFyIGE9clt0LmNoYXJDb2RlQXQodS0xKV08PHUlNCoyLGM9clt0LmNoYXJDb2RlQXQodSldPj4+Ni11JTQqMjtvW2k+Pj4yXXw9KGF8Yyk8PDI0LWklNCo4LGkrK31yZXR1cm4gZS5jcmVhdGUobyxpKX0odCxuLG8pfSxfbWFwOiJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSJ9LG8uZW5jLkJhc2U2NCl9KSksc3I9dSgoZnVuY3Rpb24odCxuKXt2YXIgcjt0LmV4cG9ydHM9KHI9Y3IsZnVuY3Rpb24oKXtpZigiZnVuY3Rpb24iPT10eXBlb2YgQXJyYXlCdWZmZXIpe3ZhciB0PXIubGliLldvcmRBcnJheSxuPXQuaW5pdDsodC5pbml0PWZ1bmN0aW9uKHQpe2lmKHQgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmKHQ9bmV3IFVpbnQ4QXJyYXkodCkpLCh0IGluc3RhbmNlb2YgSW50OEFycmF5fHwidW5kZWZpbmVkIiE9dHlwZW9mIFVpbnQ4Q2xhbXBlZEFycmF5JiZ0IGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQxNkFycmF5fHx0IGluc3RhbmNlb2YgVWludDE2QXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQzMkFycmF5fHx0IGluc3RhbmNlb2YgVWludDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBGbG9hdDY0QXJyYXkpJiYodD1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQsdC5ieXRlTGVuZ3RoKSksdCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpe2Zvcih2YXIgcj10LmJ5dGVMZW5ndGgsZT1bXSxvPTA7bzxyO28rKyllW28+Pj4yXXw9dFtvXTw8MjQtbyU0Kjg7bi5jYWxsKHRoaXMsZSxyKX1lbHNlIG4uYXBwbHkodGhpcyxhcmd1bWVudHMpfSkucHJvdG90eXBlPXR9fSgpLHIubGliLldvcmRBcnJheSl9KSk7ZnVuY3Rpb24gbHIodCl7cmV0dXJuIG9yKHQpP3NyLmNyZWF0ZSh0KS50b1N0cmluZyhmcik6IiJ9ZnVuY3Rpb24gdnIodCl7aWYoIW9uKHQpKXJldHVybiBuZXcgVWludDhBcnJheTtmb3IodmFyIG49ZnIucGFyc2UodCkscj1uLndvcmRzLGU9bi5zaWdCeXRlcyxvPW5ldyBVaW50OEFycmF5KGUpLGk9MDtpPGU7aSsrKXt2YXIgdT1yW2k+Pj4yXT4+PjI0LWklNCo4JjI1NTtvW2ldPXV9cmV0dXJuIG99ZnVuY3Rpb24gcHIodCl7cmV0dXJuIGlyKHQpP2xyKGZ1bmN0aW9uKHQpe3JldHVybiBpcih0KT9uZXcgVWludDhBcnJheSh0KTpuZXcgVWludDhBcnJheX0odCkpOiIifWZ1bmN0aW9uIGhyKHQpe3JldHVybiBvbih0KT9mdW5jdGlvbih0KXtyZXR1cm4gb3IodCk/bmV3IFVpbnQxNkFycmF5KHQpOm5ldyBVaW50MTZBcnJheX0odnIodCkpOm5ldyBVaW50MTZBcnJheX12YXIgeXI9IltVaW50OEFycmF5XTo6Ijt2YXIgZHI9IltVaW50MTZBcnJheV06OiI7dmFyIGdyPXt0YWdVOEE6eXIsdThhcnIyYjY0OmZ1bmN0aW9uKHQpe3JldHVybiBvcih0KT95citscih0KTp0fSxiNjQydThhcnI6ZnVuY3Rpb24odCl7cmV0dXJuIG9uKHQpJiZ1cih0LHlyLmxlbmd0aCk9PT15cj92cih0PWFyKHQseXIubGVuZ3RoKSk6dH0sdGFnVTE2QTpkcix1MTZhcnIyYjY0OmZ1bmN0aW9uKHQpe3JldHVybiBpcih0KT9kcitwcih0KTp0fSxiNjQydTE2YXJyOmZ1bmN0aW9uKHQpe3JldHVybiBvbih0KSYmdXIodCxkci5sZW5ndGgpPT09ZHI/aHIodD1hcih0LGRyLmxlbmd0aCkpOnR9fTtmdW5jdGlvbiBicih0KXtyZXR1cm4iW29iamVjdCBBcnJheV0iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpfWZ1bmN0aW9uIF9yKHQpe3ZhciBuLHI9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOiJVaW50OEFycmF5IjtpZihuPXQsIltvYmplY3QgVW5kZWZpbmVkXSI9PT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobikpcmV0dXJuIiI7aWYob24ocikpcj1bcl07ZWxzZSBpZighYnIocikpcmV0dXJuIiI7dmFyIGU9IiI7dHJ5e2U9SlNPTi5zdHJpbmdpZnkodCwoZnVuY3Rpb24odCxuKXtyZXR1cm4gci5pbmRleE9mKCJVaW50OEFycmF5Iik+PTAmJihuPWdyLnU4YXJyMmI2NChuKSksci5pbmRleE9mKCJVaW50MTZBcnJheSIpPj0wJiYobj1nci51MTZhcnIyYjY0KG4pKSxufSkpfWNhdGNoKHQpe2U9IiJ9cmV0dXJuIGV9dmFyIG1yPWZ1bmN0aW9uKHQsbixyKXt2YXIgZT10Lmxlbmd0aDtyZXR1cm4gcj12b2lkIDA9PT1yP2U6ciwhbiYmcj49ZT90OmRuKHQsbixyKX0sd3I9UmVnRXhwKCJbXFx1MjAwZFxcdWQ4MDAtXFx1ZGZmZlxcdTAzMDAtXFx1MDM2ZlxcdWZlMjAtXFx1ZmUyZlxcdTIwZDAtXFx1MjBmZlxcdWZlMGVcXHVmZTBmXSIpO3ZhciBqcj1mdW5jdGlvbih0KXtyZXR1cm4gd3IudGVzdCh0KX0sQXI9IltvYmplY3QgUmVnRXhwXSI7dmFyIE9yPWZ1bmN0aW9uKHQpe3JldHVybiBqKHQpJiZ3KHQpPT1Bcn0seHI9RG4mJkRuLmlzUmVnRXhwLFNyPXhyP1JuKHhyKTpPcjt2YXIgVXI9ZnVuY3Rpb24odCl7cmV0dXJuIHQuc3BsaXQoIiIpfSxCcj0iW1xcdWQ4MDAtXFx1ZGZmZl0iLGtyPSJbXFx1MDMwMC1cXHUwMzZmXFx1ZmUyMC1cXHVmZTJmXFx1MjBkMC1cXHUyMGZmXSIsQ3I9IlxcdWQ4M2NbXFx1ZGZmYi1cXHVkZmZmXSIsenI9IlteXFx1ZDgwMC1cXHVkZmZmXSIsUHI9Iig/OlxcdWQ4M2NbXFx1ZGRlNi1cXHVkZGZmXSl7Mn0iLEVyPSJbXFx1ZDgwMC1cXHVkYmZmXVtcXHVkYzAwLVxcdWRmZmZdIixNcj0iKD86IitrcisifCIrQ3IrIikiKyI/IixMcj0iW1xcdWZlMGVcXHVmZTBmXT8iK01yKygiKD86XFx1MjAwZCg/OiIrW3pyLFByLEVyXS5qb2luKCJ8IikrIilbXFx1ZmUwZVxcdWZlMGZdPyIrTXIrIikqIiksRnI9Iig/OiIrW3pyK2tyKyI/IixrcixQcixFcixCcl0uam9pbigifCIpKyIpIixUcj1SZWdFeHAoQ3IrIig/PSIrQ3IrIil8IitGcitMciwiZyIpO3ZhciBXcj1mdW5jdGlvbih0KXtyZXR1cm4gdC5tYXRjaChUcil8fFtdfTt2YXIgSXI9ZnVuY3Rpb24odCl7cmV0dXJuIGpyKHQpP1dyKHQpOlVyKHQpfSwkcj00Mjk0OTY3Mjk1O3ZhciBOcj1mdW5jdGlvbih0LG4scil7cmV0dXJuIHImJiJudW1iZXIiIT10eXBlb2YgciYmQW4odCxuLHIpJiYobj1yPXZvaWQgMCksKHI9dm9pZCAwPT09cj8kcjpyPj4+MCk/KHQ9SXQodCkpJiYoInN0cmluZyI9PXR5cGVvZiBufHxudWxsIT1uJiYhU3IobikpJiYhKG49V3QobikpJiZqcih0KT9tcihJcih0KSwwLHIpOnQuc3BsaXQobixyKTpbXX07dmFyIFJyPWZ1bmN0aW9uKHQsbixyKXt2YXIgZT1udWxsPT10PzA6dC5sZW5ndGg7cmV0dXJuIGU/KG49cnx8dm9pZCAwPT09bj8xOnJuKG4pLGRuKHQsbjwwPzA6bixlKSk6W119LERyPU1hdGguY2VpbCxIcj1NYXRoLm1heDt2YXIgR3I9ZnVuY3Rpb24odCxuLHIsZSl7Zm9yKHZhciBvPS0xLGk9SHIoRHIoKG4tdCkvKHJ8fDEpKSwwKSx1PUFycmF5KGkpO2ktLTspdVtlP2k6KytvXT10LHQrPXI7cmV0dXJuIHV9O3ZhciBxcj1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24obixyLGUpe3JldHVybiBlJiYibnVtYmVyIiE9dHlwZW9mIGUmJkFuKG4scixlKSYmKHI9ZT12b2lkIDApLG49bm4obiksdm9pZCAwPT09cj8ocj1uLG49MCk6cj1ubihyKSxlPXZvaWQgMD09PWU/bjxyPzE6LTE6bm4oZSksR3IobixyLGUsdCl9fSgpO2Z1bmN0aW9uIEpyKHQsbil7cmV0dXJuIHI9dCwiW29iamVjdCBPYmplY3RdIj09PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChyKSYmKCEhdW4obikmJm4gaW4gdCk7dmFyIHJ9dmFyIFZyPXt9O2Z1bmN0aW9uIEtyKHQsbil7dmFyIHI9TnIodCwifCIpLGU9clswXSxvPVl0KHJbMV0pLGk9WXQoclsyXSksdT1CbihScihyLDMpLCJ8Iik7aWYoSnIoVnIsZSl8fChWcltlXT17fSksVnJbZV1bIl8iK29dPXUsbz09PWktMSl7dmFyIGE9IiI7ZXIocXIoaSksKGZ1bmN0aW9uKHQpe2ErPVZyW2VdWyJfIit0XX0pKSxkZWxldGUgVnJbZV0sbihmdW5jdGlvbih0KXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06IlVpbnQ4QXJyYXkiO2lmKG9uKG4pKW49W25dO2Vsc2UgaWYoIWJyKG4pKXJldHVybnt9O3ZhciByPXt9O3RyeXtyPUpTT04ucGFyc2UodCwoZnVuY3Rpb24odCxyKXtyZXR1cm4gbi5pbmRleE9mKCJVaW50OEFycmF5Iik+PTAmJihyPWdyLmI2NDJ1OGFycihyKSksbi5pbmRleE9mKCJVaW50MTZBcnJheSIpPj0wJiYocj1nci5iNjQydTE2YXJyKHIpKSxyfSkpfWNhdGNoKHQpe3I9e319cmV0dXJuIHJ9KGEpKX19cmV0dXJuIGZ1bmN0aW9uKHQpe3ZhciBuPSExLGU9bnVsbCxvPW5ldyB5bixpPW5ldyB5bjtmdW5jdGlvbiB1KHQpe2Zvcih2YXIgbj1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KG4+MT9uLTE6MCksZT0xO2U8bjtlKyspcltlLTFdPWFyZ3VtZW50c1tlXTtzZXRUaW1lb3V0KChmdW5jdGlvbigpe28uZW1pdC5hcHBseShvLFt0XS5jb25jYXQocikpfSksMSl9ZnVuY3Rpb24gYSgpe3QudXJsfHwodC51cmw9IndzOi8vbG9jYWxob3N0OjgwODAiKSx0LnRva2VufHwodC50b2tlbj0iKiIpLHQuc3RyU3BsaXRMZW5ndGh8fCh0LnN0clNwbGl0TGVuZ3RoPTFlNik7dmFyIGE9e3VybDp0LnVybCx0b2tlbjp0LnRva2VuLG9wZW46ZnVuY3Rpb24oKXt1KCJvcGVuIiksbnx8KHUoIm9wZW5PbmNlIiksbj0hMCl9LGNsb3NlOmZ1bmN0aW9uKCl7dSgiY2xvc2UiKSxjKCl9LG1lc3NhZ2U6ZnVuY3Rpb24odCl7IWZ1bmN0aW9uKHQpe0tyKHQscyl9KHQpfSxlcnJvcjpmdW5jdGlvbih0KXtmKHQpfX07dHJ5e2U9bmV3IHIoYSl9Y2F0Y2godCl7cmV0dXJuIHUoImVycm9yIix7bXNnOiJjYW4gbm90IGNyZWF0ZSB3ZWJzb2NrZXQiLGVycjp0fSksdm9pZCBjKCl9aWYoSHQoZSwiZXJyb3IiKSlyZXR1cm4gdSgiZXJyb3IiLHttc2c6ImNhbiBub3QgY3JlYXRlIHdlYnNvY2tldCIsZXJyOiJjYW4gbm90IG5ldyBNaXhXUyBpbiBXV2Vic29ja2V0Q2xpZW50In0pLHZvaWQgYygpO2Z1bmN0aW9uIGYodCl7dSgiZXJyb3IiLHttc2c6IndlYnNvY2tldCBlcnJvciIsZXJyOnR9KSxlLmNsb3NlKCl9ZnVuY3Rpb24gcyh0KXt2YXIgbj1IdCh0LCJfbW9kZSIsIiIpO2lmKCJleGVjdXRlIj09PW4paWYoSHQodCwiX2lkIikmJkh0KHQsIm91dHB1dCIpKXt2YXIgcj1IdCh0LCJfaWQiKSxlPUh0KHQsIm91dHB1dCIpO2kuZW1pdChyLGUpfWVsc2UgdSgiZXJyb3IiLHttc2c6ImNhbiBub3QgZmluZCBfaWQgYW5kIG91dHB1dCBpbiBkYXRhIixlcnI6dH0pO2Vsc2UiYnJvYWRjYXN0Ij09PW4/dSgiYnJvYWRjYXN0IixIdCh0LCJkYXRhIikpOiJkZWxpdmVyIj09PW4/dSgiZGVsaXZlciIsSHQodCwiZGF0YSIpKTpmKHttc2c6ImNhbiBub3QgZmluZCBfbW9kZSBpbiBkYXRhIixlcnI6dH0pfWZ1bmN0aW9uIGwobixyKXtlLnJlYWR5U3RhdGU9PT1lLk9QRU4mJmZ1bmN0aW9uKHQsbixyLGUsbyl7dmFyIGk9X3IociksdT1TbihpLG4pLGE9cG4oKSxjPXUubGVuZ3RoO2VyKHUsKGZ1bmN0aW9uKG4scil7bj1CbihuLCIiKTt2YXIgaT0iIi5jb25jYXQoYSwifCIpLmNvbmNhdChyLCJ8IikuY29uY2F0KGMsInwiKS5jb25jYXQobik7dC5zZW5kKGksKGZ1bmN0aW9uKHQpe3QmJk0obykmJm8odCl9KSksTShlKSYmZSgocisxKS9jKjEwMCl9KSl9KGUsdC5zdHJTcGxpdExlbmd0aCxuLHIsKGZ1bmN0aW9uKHQpe3UoImVycm9yIix7bXNnOiJjYW4gbm90IHNlbmQgbWVzc2FnZSIsZXJyOnR9KX0pKX1vLnJlbW92ZUFsbExpc3RlbmVycygidHJpZ2dlckV4ZWN1dGUiKSxvLm9uKCJ0cmlnZ2VyRXhlY3V0ZSIsKGZ1bmN0aW9uKHQpe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTpudWxsLHI9YXJndW1lbnRzLmxlbmd0aD4yP2FyZ3VtZW50c1syXTp2b2lkIDAsZT1hcmd1bWVudHMubGVuZ3RoPjM/YXJndW1lbnRzWzNdOnZvaWQgMCxvPXBuKCk7bCh7X21vZGU6ImV4ZWN1dGUiLF9pZDpvLGZ1bmM6dCxpbnB1dDpufSxlKSxpLm9uKG8sKGZ1bmN0aW9uKHQpe3IodCksaS5yZW1vdmVBbGxMaXN0ZW5lcnMobyl9KSl9KSksby5yZW1vdmVBbGxMaXN0ZW5lcnMoInRyaWdnZXJCcm9hZGNhc3QiKSxvLm9uKCJ0cmlnZ2VyQnJvYWRjYXN0IiwoZnVuY3Rpb24odCxuKXtsKHtfbW9kZToiYnJvYWRjYXN0IixkYXRhOnR9LG4pfSkpLG8ucmVtb3ZlQWxsTGlzdGVuZXJzKCJ0cmlnZ2VyRGVsaXZlciIpLG8ub24oInRyaWdnZXJEZWxpdmVyIiwoZnVuY3Rpb24odCxuKXtsKHtfbW9kZToiZGVsaXZlciIsZGF0YTp0fSxuKX0pKX1mdW5jdGlvbiBjKCl7c2V0VGltZW91dCgoZnVuY3Rpb24oKXt1KCJyZWNvbm4iKSxhKCl9KSwxZTMpfXJldHVybiBvLmV4ZWN1dGU9ZnVuY3Rpb24odCxuKXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06ZnVuY3Rpb24oKXt9LGU9R3QoKTtyZXR1cm4gdSgidHJpZ2dlckV4ZWN1dGUiLHQsbiwoZnVuY3Rpb24odCl7ZS5yZXNvbHZlKHQpfSksciksZX0sby5icm9hZGNhc3Q9ZnVuY3Rpb24odCl7dmFyIG49YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOmZ1bmN0aW9uKCl7fTt1KCJ0cmlnZ2VyQnJvYWRjYXN0Iix0LG4pfSxvLmRlbGl2ZXI9ZnVuY3Rpb24odCl7dmFyIG49YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOmZ1bmN0aW9uKCl7fTt1KCJ0cmlnZ2VyRGVsaXZlciIsdCxuKX0sYSgpLG99fSgpO3ZhciB3bz1udWxsLGJJbml0PSExO2Z1bmN0aW9uIGluaXQoYSl7YkluaXR8fCh3bz1uZXcgV0NvbnZlcndzQ2xpZW50KGEpLHdvLm9uKCJvcGVuIixmdW5jdGlvbigpe3NlbmRTeXN0ZW1NZXNzYWdlKCJvcGVuIil9KSx3by5vbigib3Blbk9uY2UiLGZ1bmN0aW9uKCl7c2VuZFN5c3RlbU1lc3NhZ2UoIm9wZW5PbmNlIiksYkluaXQ9ITB9KSx3by5vbigiY2xvc2UiLGZ1bmN0aW9uKCl7c2VuZFN5c3RlbU1lc3NhZ2UoImNsb3NlIil9KSx3by5vbigiZXJyb3IiLGZ1bmN0aW9uKGEpe3NlbmRTeXN0ZW1NZXNzYWdlKCJlcnJvciIsYSl9KSx3by5vbigicmVjb25uIixmdW5jdGlvbigpe3NlbmRTeXN0ZW1NZXNzYWdlKCJyZWNvbm4iKX0pLHdvLm9uKCJicm9hZGNhc3QiLGZ1bmN0aW9uKGEpe3NlbmRTeXN0ZW1NZXNzYWdlKCJicm9hZGNhc3QiLGEpfSksd28ub24oImRlbGl2ZXIiLGZ1bmN0aW9uKGEpe3NlbmRTeXN0ZW1NZXNzYWdlKCJkZWxpdmVyIixhKX0pKX1mdW5jdGlvbiBzZW5kTWVzc2FnZShhKXtzZWxmLnBvc3RNZXNzYWdlKGEpfWZ1bmN0aW9uIHNlbmRTeXN0ZW1NZXNzYWdlKGEpe3ZhciBiPTE8YXJndW1lbnRzLmxlbmd0aCYmYXJndW1lbnRzWzFdIT09dm9pZCAwP2FyZ3VtZW50c1sxXTpudWxsO3NlbmRNZXNzYWdlKHtfaWQ6InN5c3RlbSIsZnVuYzphLGRhdGE6Yn0pfXNlbGYub25tZXNzYWdlPWZ1bmN0aW9uKGEpe3ZhciBiPWEuZGF0YSxjPWIudHlwZTtpZigiaW5pdCI9PT1jKXt2YXIgZD1iLl9pZCxlPWIuaW5wdXQ7aW5pdChlKTt2YXIgaz1zZXRJbnRlcnZhbChmdW5jdGlvbigpe2lmKGJJbml0KXtzZW5kTWVzc2FnZSh7X2lkOmQsb3V0cHV0Om51bGx9KSxjbGVhckludGVydmFsKGspfX0sMTApfWVsc2UgaWYoImV4ZWN1dGUiPT09Yyl7dmFyIGY9Yi5faWQsZz1iLmZ1bmMsaD1iLmlucHV0O3dvLmV4ZWN1dGUoZyxoLGZ1bmN0aW9uKGEpe3NlbmRNZXNzYWdlKHtfaWQ6Zixwcm9nOmF9KX0pLnRoZW4oZnVuY3Rpb24oYSl7c2VuZE1lc3NhZ2Uoe19pZDpmLG91dHB1dDphfSl9KX1lbHNlIGlmKCJicm9hZGNhc3QiPT09Y3x8ImRlbGl2ZXIiPT09Yyl7dmFyIGk9Yi5faWQsaj1iLmlucHV0O3dvW2NdKGosZnVuY3Rpb24oYSl7c2VuZE1lc3NhZ2Uoe19pZDppLHByb2c6YX0pfSl9ZWxzZSBzZW5kU3lzdGVtTWVzc2FnZSgiZXJyb3IiLCJ0eXBlIGVycm9yOiAiLmNvbmNhdChjKSl9Ow=='

//code
//let code = b642u8arr(codeB64)
let code = b642str(codeB64)


function genWebWorker(code) {

    //URL
    let URL = window.URL || window.webkitURL

    //blob
    let blob
    try {
        //BlobBuilder for IE11, 依然有安全性問題
        let BlobBuilder = window.BlobBuilder ||
            window.WebKitBlobBuilder ||
            window.MozBlobBuilder ||
            window.MSBlobBuilder
        blob = new BlobBuilder()
        blob.append(code)
        blob = blob.getBlob()
        return new Worker(URL.createObjectURL(blob))
    }
    catch (e) {
        //console.log('can not use BlobBuilder', e)
    }

    try {
        //blob for Chrome 8+, Firefox 6+, Safari 6.0+, Opera 15+
        blob = new Blob([code])
        return new Worker(URL.createObjectURL(blob))
    }
    catch (e) {
        //console.log('can not use Blob', e)
    }

    try {
        //data:application/javascript for Opera 10.60 - 12
        return new Worker('data:application/javascript,' + encodeURIComponent(code))
    }
    catch (e) {
        //console.log('can not use application/javascript', e)
    }

    return null
}


/**
 * 於瀏覽器(Browser)通過Web Worker建立WebSocket使用者端物件
 *
 * @class
 * @param {Object} opt 輸入設定參數物件
 * @param {String} [opt.url='ws://localhost:8080'] 輸入WebSocket伺服器ws網址，預設為'ws://localhost:8080'
 * @param {String} [opt.token='*'] 輸入使用者認證用token，預設為'*'
 * @param {Integer} [opt.strSplitLength=1000000] 輸入傳輸封包長度整數，預設為1000000
 * @returns {Object} 回傳通訊物件，可監聽事件open、openOnce、close、error、reconn、broadcast、deliver，可使用函數execute、broadcast、deliver
 * @example
 *
 * <script src="dist/w-converws-client-webworker.umd.js"></script>
 *
 * let opt = {
 *     url: 'ws://localhost:8080',
 *     token: '*',
 * }
 *
 * //new
 * let WConverwsClient = window['w-converws-client-webworker']
 * let wo = new WConverwsClient(opt)
 *
 * wo.on('open', function() {
 *     console.log('client web: open')
 * })
 * wo.on('openOnce', function() {
 *     console.log('client web: openOnce')
 *
 *     //execute
 *     wo.execute('add', { p1: 1, p2: 2 },
 *         function (prog) {
 *             console.log('client web: execute prog=', prog)
 *         })
 *         .then(function(r) {
 *             console.log('client web: execute: add=', r)
 *         })
 *
 *     //broadcast
 *     wo.broadcast('client web broadcast hi', function (prog) {
 *         console.log('client web: broadcast prog=', prog)
 *     })
 *
 *     //deliver
 *     wo.deliver('client deliver hi', function (prog) {
 *         console.log('client web: deliver prog=', prog)
 *     })
 *
 * })
 * wo.on('close', function() {
 *     console.log('client web: close')
 * })
 * wo.on('error', function(err) {
 *     console.log('client web: error=', err)
 * })
 * wo.on('reconn', function() {
 *     console.log('client web: reconn')
 * })
 * wo.on('broadcast', function(data) {
 *     console.log('client web: broadcast=', data)
 * })
 * // wo.on('deliver', function(data) { //伺服器目前無法針對client直接deliver
 * //     console.log('client web: deliver=', data)
 * // })
 *
 */
function WConverwsClientWebworker(opt) {


    //ee
    let ee = new Evem()


    //wk
    // let blob = new Blob([code], { type: 'text/javascript' })
    // let url = URL.createObjectURL(blob)
    // let wk = new Worker(url)
    // let wk = new Worker('./wkapi/wscs_webworker.mjs')
    let wk = genWebWorker(code)


    //check, IE11安全性問題
    if (wk === null) {
        return null
    }


    function init(opt) {

        //_id
        let _id = genID()

        //msg
        let msg = {
            _id,
            type: 'init',
            input: opt,
        }

        //postMessage
        wk.postMessage(msg)

    }
    init(opt)


    function terminate() {
        wk.terminate()
        wk = undefined
    }


    function execute(func, input, callback) {

        //pm
        let pm = genPm()

        //_id
        let _id = genID()

        //msg
        let msg = {
            _id,
            type: 'execute',
            func,
            input,
        }

        //postMessage
        wk.postMessage(msg)

        //等待結果回傳
        ee.on(_id, function (data) {

            //prog
            if (data.prog) {

                if (isfun(callback)) {

                    //callback
                    callback(data.prog)

                }

            }
            //output
            else {

                //resolve
                pm.resolve(data.output)

                //removeAllListeners
                ee.removeAllListeners(_id)

            }

        })

        return pm
    }


    function core(type, input, callback) {

        //pm
        let pm = genPm()

        //_id
        let _id = genID()

        //msg
        let msg = {
            _id,
            type,
            input,
        }

        //postMessage
        wk.postMessage(msg)

        //等待結果回傳
        ee.on(_id, function (data) {

            //callback
            if (isfun(callback)) {
                callback(data.prog)
            }

            //finish
            if (data.prog === 100) {

                //resolve
                pm.resolve()

                //removeAllListeners
                ee.removeAllListeners(_id)

            }

        })

        return pm
    }


    function broadcast(input, callback) {
        return core('broadcast', input, callback)
    }


    function deliver(input, callback) {
        return core('deliver', input, callback)
    }


    wk.onmessage = function (e) {

        //data
        let data = e.data

        //_id
        let _id = data._id

        if (_id !== 'system') {

            //emit
            ee.emit(_id, data)

        }
        else {

            //emit
            ee.emit(data.func, data.data)

        }

    }


    //save
    ee.execute = execute
    ee.broadcast = broadcast
    ee.deliver = deliver
    ee.terminate = terminate


    return ee
}


export default WConverwsClientWebworker
